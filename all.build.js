(function(global){var k,_handlers={},_mods={16:false,18:false,17:false,91:false},_scope="all",_MODIFIERS={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},_MAP={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},code=function(x){return _MAP[x]||x.toUpperCase().charCodeAt(0)},_downKeys=[];for(k=1;k<20;k++)_MAP["f"+k]=111+k;function index(array,item){var i=array.length;while(i--)if(array[i]===item)return i;return-1}function compareArray(a1,a2){if(a1.length!=a2.length)return false;for(var i=0;i<a1.length;i++){if(a1[i]!==a2[i])return false}return true}var modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};function updateModifierKey(event){for(k in _mods)_mods[k]=event[modifierMap[k]]}function dispatch(event){var key,handler,k,i,modifiersMatch,scope;key=event.keyCode;if(index(_downKeys,key)==-1){_downKeys.push(key)}if(key==93||key==224)key=91;if(key in _mods){_mods[key]=true;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=true;return}updateModifierKey(event);if(!assignKey.filter.call(this,event))return;if(!(key in _handlers))return;scope=getScope();for(i=0;i<_handlers[key].length;i++){handler=_handlers[key][i];if(handler.scope==scope||handler.scope=="all"){modifiersMatch=handler.mods.length>0;for(k in _mods)if(!_mods[k]&&index(handler.mods,+k)>-1||_mods[k]&&index(handler.mods,+k)==-1)modifiersMatch=false;if(handler.mods.length==0&&!_mods[16]&&!_mods[18]&&!_mods[17]&&!_mods[91]||modifiersMatch){if(handler.method(event,handler)===false){if(event.preventDefault)event.preventDefault();else event.returnValue=false;if(event.stopPropagation)event.stopPropagation();if(event.cancelBubble)event.cancelBubble=true}}}}}function clearModifier(event){var key=event.keyCode,k,i=index(_downKeys,key);if(i>=0){_downKeys.splice(i,1)}if(key==93||key==224)key=91;if(key in _mods){_mods[key]=false;for(k in _MODIFIERS)if(_MODIFIERS[k]==key)assignKey[k]=false}}function resetModifiers(){for(k in _mods)_mods[k]=false;for(k in _MODIFIERS)assignKey[k]=false}function assignKey(key,scope,method){var keys,mods;keys=getKeys(key);if(method===undefined){method=scope;scope="all"}for(var i=0;i<keys.length;i++){mods=[];key=keys[i].split("+");if(key.length>1){mods=getMods(key);key=[key[key.length-1]]}key=key[0];key=code(key);if(!(key in _handlers))_handlers[key]=[];_handlers[key].push({shortcut:keys[i],scope:scope,method:method,key:keys[i],mods:mods})}}function unbindKey(key,scope){var multipleKeys,keys,mods=[],i,j,obj;multipleKeys=getKeys(key);for(j=0;j<multipleKeys.length;j++){keys=multipleKeys[j].split("+");if(keys.length>1){mods=getMods(keys);key=keys[keys.length-1]}key=code(key);if(scope===undefined){scope=getScope()}if(!_handlers[key]){return}for(i=0;i<_handlers[key].length;i++){obj=_handlers[key][i];if(obj.scope===scope&&compareArray(obj.mods,mods)){_handlers[key][i]={}}}}}function isPressed(keyCode){if(typeof keyCode=="string"){keyCode=code(keyCode)}return index(_downKeys,keyCode)!=-1}function getPressedKeyCodes(){return _downKeys.slice(0)}function filter(event){var tagName=(event.target||event.srcElement).tagName;return!(tagName=="INPUT"||tagName=="SELECT"||tagName=="TEXTAREA")}for(k in _MODIFIERS)assignKey[k]=false;function setScope(scope){_scope=scope||"all"}function getScope(){return _scope||"all"}function deleteScope(scope){var key,handlers,i;for(key in _handlers){handlers=_handlers[key];for(i=0;i<handlers.length;){if(handlers[i].scope===scope)handlers.splice(i,1);else i++}}}function getKeys(key){var keys;key=key.replace(/\s/g,"");keys=key.split(",");if(keys[keys.length-1]==""){keys[keys.length-2]+=","}return keys}function getMods(key){var mods=key.slice(0,key.length-1);for(var mi=0;mi<mods.length;mi++)mods[mi]=_MODIFIERS[mods[mi]];return mods}function addEvent(object,event,method){if(object.addEventListener)object.addEventListener(event,method,false);else if(object.attachEvent)object.attachEvent("on"+event,function(){method(window.event)})}addEvent(document,"keydown",function(event){dispatch(event)});addEvent(document,"keyup",clearModifier);addEvent(window,"focus",resetModifiers);var previousKey=global.key;function noConflict(){var k=global.key;global.key=previousKey;return k}global.key=assignKey;global.key.setScope=setScope;global.key.getScope=getScope;global.key.deleteScope=deleteScope;global.key.filter=filter;global.key.isPressed=isPressed;global.key.getPressedKeyCodes=getPressedKeyCodes;global.key.noConflict=noConflict;global.key.unbind=unbindKey;if(typeof module!=="undefined")module.exports=assignKey})(this);"use strict";var oxford_comma=function(arr){switch(arr.length){case 1:return arr[0];case 2:return arr[0]+" and "+arr[1];case 3:return arr[0]+", "+arr[1]+", and "+arr[2]}};var rotate=function(el,deg){el.style.transform="rotate("+deg+"deg)";el.style.webkitTansform="rotate("+deg+"deg)";el.style.mozTransform="rotate("+deg+"deg)"};var translate=function(el,x,y){var str=x==null?"":"translate("+x+"px,"+y+"px)";el.style.transform=str;el.style.webkitTransform=str;el.style.mozTransform=str};var text_multi=function(el,text,truncate_long_words){if(truncate_long_words){text=text.replace(/(\S{25})\S*/g,"$1...")}el.textContent=text;el.innerHTML=el.innerHTML.replace(/\n/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp; ")};var escape_str=function(str){return str.replace(/[\u00A0-\u9999<>\&]/g,function(i){return"&#"+i.charCodeAt(0)+";"})};var css_animation=function(){var timers=[];var els=[];return function(el,cls,callback,delay){el.classList.remove(cls);el.offsetTop;var old_idx=els.indexOf(el);if(old_idx!=-1){clearTimeout(timers[old_idx]);timers.splice(old_idx,1);els.splice(old_idx,1)}els.push(el);timers.push(setTimeout(callback,delay));el.classList.add(cls)}}();var stop_propagation=function(e){e.stopPropagation()};var prevent_default=function(e){e.preventDefault()};"use strict";var DropDown=function(val_array){var str=val_array.map(function(val){return"<div class='dropdown_item' title='"+escape_str(val)+"'>"+escape_str(val)+"</div>"}).join("");this.val_array=val_array.slice(0);this.el_list=document.createElement("div");this.el_list.className="dropdown_item_list";this.el_list.tabindex=-1;this.el_list.style.display="none";this.el_list.innerHTML=str;this.el_collapsed=document.createElement("div");this.el_collapsed.className="dropdown_collapsed";this.el=document.createElement("div");this.el.className="dropdown";this.el.appendChild(this.el_list);this.el.appendChild(this.el_collapsed);this.ind=0;this.el_collapsed.textContent=val_array[0];this.event_callbacks={};this.open=false;var dd=this;this.document_mousedown=function(e){dd.el_list.style.display="none";dd.open=false;dd.trigger("blur");document.removeEventListener("mousedown",dd.document_mousedown)};this.el_collapsed.addEventListener("mousedown",function(){if(!dd.trigger("click"))return;dd.el.parentNode.classList.add("selected");dd.el_list.style.display="";this.open=true;setTimeout(function(){dd.el_list.focus();dd.el_list.scrollTop=dd.el_list.children[dd.ind].offsetTop;document.addEventListener("mousedown",dd.document_mousedown)},1)});var on_click=function(e){dd.SetInd(this.getAttribute("data-ind"));dd.el_list.style.display="none";dd.open=false;e.stopPropagation();document.removeEventListener("mousedown",dd.document_mousedown)};for(var ii=0;ii<this.el_list.children.length;ii++){this.el_list.children[ii].setAttribute("data-ind",ii);this.el_list.children[ii].addEventListener("click",on_click)}return this};DropDown.FakeEvent=function(){this.is_stopped=false};DropDown.FakeEvent.prototype.stopImmediatePropagation=function(){this.is_stopped=true};DropDown.prototype.addEventListener=function(evt,func){if(!(evt in this.event_callbacks))this.event_callbacks[evt]=[];this.event_callbacks[evt].push(func)};DropDown.prototype.trigger=function(evt,args){var fe=new DropDown.FakeEvent;if(evt in this.event_callbacks){for(var ii=0;ii<this.event_callbacks[evt].length;ii++)this.event_callbacks[evt][ii].call(this,fe);if(fe.is_stopped)return false}return true};DropDown.prototype.IndexOf=function(val){return this.val_array.indexOf(val)};DropDown.prototype.GetVal=function(){return this.val_array[this.ind]};DropDown.prototype.SetInd=function(ind,no_trigger){ind=parseInt(ind);if(ind===this.ind)return;this.el_list.children[this.ind].classList.remove("selected");this.el_collapsed.textContent=this.val_array[ind];this.el_collapsed.title=escape_str(this.val_array[ind]);this.ind=ind;this.el_list.children[ind].classList.add("selected");if(!no_trigger)this.trigger("change",{ind:ind,str:this.val_array[ind],isOpen:this.open})};DropDown.prototype.SetSelected=function(v){if(v)this.el.parentNode.classList.add("selected");else this.el.parentNode.classList.remove("selected")};"use strict";dn.menu_id_to_caption={menu_print:"print",menu_sharing:"sharing",menu_save:"save",menu_history:"history",menu_file:"current file",menu_new:"new",menu_open:"new/open",menu_find:"find/replace",menu_goto:"goto line",menu_general_settings:"general settings",menu_shortcuts:"shortcuts",menu_drive:"drive",menu_help:"about/help"};dn.shortcuts_list=["cut|Ctrl-X|Cmd-X","copy|Ctrl-C|Cmd-C","paste|Ctrl-V|Command-V","cycle clipboard|Cltr-[V then left or right arrow]|Command-[V then left or right arrow]","select all|Ctrl-A|Command-A","find|Ctrl(-Alt)-F","replace|Ctrl-R","go to line|Ctrl(-Alt)-L","undo|Ctrl-Z|Command-Z","redo|Ctrl-Shift-Z,Ctrl-Y|Command-Shift-Z,Command-Y"," | ","toggle widget|Esc","save|Ctrl-S|Command-S","print|Ctrl(-Alt)-P|Command-P","file history|Ctrl-H|Command-H","new|Ctrl(-Alt)-N","open|Ctrl(-Alt)-O","  | ","to upper case|Ctrl-U","to lower case|Ctr-Shift-U","modify selection|Shift-(Ctrl-)(Alt-) {Down, Up, Left, Right, End, Home, PageDown, PageUp, End}|Shift-(Command-)(Alt-) {Down, Up, Left, Right, End, Home, PageDown,End}","copy lines down|Ctrl-Alt-Down|Command-Option-Down","copy lines up|Ctrl-Alt-Up|Command-Option-Up","center selection||Ctrl-L","fold all|Alt-0|Option-0","unfold all|Alt-Shift-0|Option-Shift-0","go to end|Ctrl-End,Ctrl-Down|Command-End,Command-Down","go to line end|Alt-Right,End|Command-Right,End,Ctrl-E","go to line start|Alt-Left,Home|Command-Left,Home,Ctrl-A","go to page down|PageDown|Option-PageDown,Ctrl-V","go to page up|PageUp|Option-PageUp","go to start|Ctrl-Home,Ctrl-Up|Command-Home,Command-Up","go to word left|Ctrl-Left|Option-Left","go to word right|Ctrl-Right|Option-Right","indent|Tab","outdent|Shift-Tab","overwrite|Insert","remove line|Ctrl-D|Command-D","remove to line end||Ctrl-K","remove to linestart||Option-Backspace","remove word left||Alt-Backspace,Ctrl-Alt-Backspace","remove word right||Alt-Delete","split line||Ctrl-O","toggle comment|Ctrl-7|Command-7","transpose letters|Ctrl-T"];dn.ext_to_mime_type={html:"text/html",htm:"text/html",js:"text/javascript",pl:"application/x-perl",xml:"text/xml",c:"text/x-csrc",cpp:"text/x-c++src",h:"text/x-chdr",json:"application/json",php:"application/x-php",svg:"text/html",css:"text/css",java:"text/x-java",py:"text/x-python",scala:"scala",textile:"textile",tex:"application/x-tex",bib:"application/x-tex",rtf:"application/rtf",rtx:"application/rtf",sh:"application/x-sh",sql:"text/x-sql",as:"text/x-actionscript"};dn.tooltip_info={save:"Save file contents.  ",print:"Open print view in a new tab.  ",sharing:"View and modify file's sharing status.","file history":"Explore the file history.  ",drive:"Show this file in Google Drive.  ",about:"Drive Notepad website.",shortcuts:"Keyboard shortcuts.","new":"Create new file in a new tab.  ",open:"Launch open dialoag.  ",settings_file:"Properties of the current file.",settings_general:"Your general Drive Notepad preferences.",title:"Click to edit the file's title.",description:"Click to edit the file's description."};var WHICH={ENTER:13,ESC:27,UP:38,DOWN:40};dn.default_settings={ext:"txt",wordWrap:[true,null,null],wordWrapAt:80,fontSize:1,widget_anchor:["l",50,"t",10],showGutterHistory:1,lastDNVersionUsed:"",newLineDefault:"windows",historyRemovedIsExpanded:true,softTabN:4,tabIsHard:0,widgetSub:"general",theme:"chrome",pane:"",pane_open:true,find_regex:false,find_whole_words:false,find_case_sensitive:false,help_inner:"main",find_goto:false,find_replace:false};dn.default_custom_props={newline:"detect",tabs:"detect",aceMode:"detect"};dn.impersonal_settings_keys=["wordWrap","wordWrapAt","fontSize","widget_anchor","showGutterHistory","historyRemovedIsExpanded","tabIsHard","softTabN","widgetSub","theme","pane","pane_open","find_regex","find_whole_words","find_case_sensitive","help_inner","find_goto","find_replace"];dn.drag_delay_ms=400;dn.drag_shift_px=40;dn.min_font_size=.3;dn.max_font_size=5;dn.max_wrap_at=200;dn.min_wrap_at=20;dn.wrap_at_increment=10;dn.max_soft_tab_n=10;dn.min_soft_tab_n=2;dn.detect_tabs_spaces_frac=.9;dn.detect_tabs_tabs_frac=.9;dn.detect_tabs_n_spaces_frac=.99;dn.detect_tabs_n_spaces_frac_for_default=.6;dn.font_size_increment=.15;dn.icon_mouse_over_ms=300;dn.editor_refocus_time_ms=500;dn.error_delay_ms=5e3;dn.find_history_add_delay=2e3;dn.clipboard_info_delay=500;dn.clipboard_max_length=20;dn.find_max_results_half=3;dn.find_max_prefix_chars=10;dn.find_max_suffix_chars=60;"use strict";dn.close_history=function(){dn.file_history.$revisions_display.remove();window.removeEventListener("resize",dn.revisions_window_resize);document.getElementById("the_editor").style.display="";dn.editor.resize();dn.is_showing_history=false};dn.revisions_window_resize=function(){if(dn.file_history.canShowResizeError){dn.show_error("The history explorer displays poorly if you resize the window while it is open. (This is a bug.)");dn.file_history.canShowResizeError=false;setTimeout(function(){dn.file_history.canShowResizeError=true},dn.error_delay_ms)}};dn.start_revisions_worker=function(){if(dn.the_file.is_brand_new){dn.show_error("This is a new file.  It doesn't have any history to explore.");return}dn.is_showing_history=true;if(!dn.file_history){dn.el.widget_content.innerHTML("afterend","<div class='widget_box widget_revisions'>"+"<div class='widget_box_title widget_revisions_title'>File History</div>"+"<div class='revision_caption_at'></div>"+"<div class='revision_timeline'></div>"+"<div class='revision_caption_from'></div>"+"<div>Removed lines: <div class='button inline_button ' id='expand_removed'>expand</div>"+"<div class='button inline_button ' id='collapse_removed'>collapse</div></div>"+"<br><div class='widget_divider'></div>"+"<div id='revisions_status'>Initialising...</div>"+"Press Esc to return to editing."+"<br><div class='widget_divider'></div>"+"Please note that the history viewing tool is missing some important features and those that have been implemented may include the odd bug.</div>");dn.el.widget_file_history=dn.el.widget_content.parentNode.getElementsByClassName("widget_revisions")[0];dn.el.widget_file_history.style.display="none";dn.file_history={$revisions_display:$("<div class='revisions_view'><ol></ol></div>"),$view:null,$new_li:$("<li class='rev_line' v='-1'/>"),$new_tick:$("<div class='revision_tick'/>"),needToRefindViewChildren:false,$rev_lines_:[],needToFixHeights:$([]),$timeline:$d.find(".revision_timeline"),$revisions_status:$d.find("#revisions_status"),$revision_caption_from:$d.find(".revision_caption_from"),$revision_caption_at:$d.find(".revision_caption_at"),$expand_removed:$d.find("#expand_removed"),$collapse_removed:$d.find("#collapse_removed"),revisions:[],revisionFromEtag:{},at:null,from:null,canShowResizeError:true,worker:new Worker("js/revisions_worker.js")};dn.file_history.$view=dn.file_history.$revisions_display.find("ol");dn.file_history.$expand_removed.addEventListener("click",function(){dn.g_settings.set("historyRemovedIsExpanded",true)});dn.file_history.$collapse_removed.addEventListener("click",function(){dn.g_settings.set("historyRemovedIsExpanded",false)});dn.revision_setis_expaned(dn.g_settings.get("historyRemovedIsExpanded"));var w=dn.file_history.worker;w.onmessage=dn.revision_worker_delivery}dn.file_history.worker.postMessage({fileId:dn.the_file.file_id,token:gapi.auth.getToken().access_token,init:true});dn.file_history.$revisions_display.appendTo($("body"));$(window).on("resize",dn.revisions_window_resize);dn.el.widget_file_history.style.display="";dn.file_history.$view.empty();$("#the_editor").style.display="none";return false};dn.revision_setis_expaned=function(v){var h=dn.file_history;if(!h)return;if(v){h.$expand_removed.classList.add("selected");h.$collapse_removed.classList.remove("selected");h.$view.setAttribute("removed","expanded")}else{h.$collapse_removed.classList.add("selected");h.$expand_removed.classList.remove("selected");h.$view.setAttribute("removed","collapsed")}};dn.revision_set_at=function(r,fromChangeEvent,fromTimelineCreation){var h=dn.file_history;h.at=r;if(!fromChangeEvent)h.$at_range.value=r.ind;text_multi(h.$revision_caption_at,r.modifiedDate.toLocaleDateString({},{month:"short",day:"numeric",year:"numeric"})+"\n"+r.modifiedDate.toLocaleTimeString({},{hour:"numeric",minute:"numeric"}));if(h.from&&!fromTimelineCreation)h.worker.postMessage({showEtag:h.at.etag,fromEtag:h.from.etag})};dn.revision_set_from=function(r,fromChangeEvent,fromTimelineCreation){var h=dn.file_history;h.from=r;if(!fromChangeEvent)h.$from_range.value=r.ind;text_multi(h.$revision_caption_from,r.modifiedDate.toLocaleDateString({},{month:"short",day:"numeric",year:"numeric"})+"\n"+r.modifiedDate.toLocaleTimeString({},{hour:"numeric",minute:"numeric"}));if(h.at&&!fromTimelineCreation)h.worker.postMessage({showEtag:h.at.etag,fromEtag:h.from.etag})};dn.display_revision_timeline=function(newRevisions){var h=dn.file_history;var rs=h.revisions;h.$at_range=$("<input class='revision_at_range' type='range' min='0' max='"+(rs.length-1)+"'/>");h.$tick_box=$("<div class='revision_tick_box'/>");h.$from_range=$("<input class='revision_from_range' type='range' min='0' max='"+(rs.length-1)+"'/>");var attr=rs.map(function(t){return{downloaded:t.isDownloaded||false}});var text=Array.apply(null,Array(attr.length)).map(function(){return""});var $ticks=h.$tick_box.insertClonedChildren(0,h.$new_tick,text,attr);for(var i=0;i<rs.length;i++){rs[i].ind=i;rs[i].$=$ticks.eq(i)}h.$timeline.empty().append(h.$at_range).append(h.$tick_box).append(h.$from_range);h.$at_range.on("change",function(){dn.revision_set_at(dn.file_history.revisions[this.value],true)});h.$from_range.on("change",function(){dn.revision_set_from(dn.file_history.revisions[this.value],true)});dn.revision_set_from(rs.length>1?rs[1]:rs[0],false,true);dn.revision_set_at(rs[0],false,true)};dn.revision_worker_delivery=function(e){if(!e.data)return;if(e.data.debug)console.log(e.data);var h=dn.file_history;if(e.data.status)text_multi(h.$revisions_status,e.data.status);if(e.data.revisions){h.revisions=e.data.revisions;e.data.revisions.forEach(function(r){h.revisionFromEtag[r.etag]=r});dn.display_revision_timeline(e.data.revisions);h.worker.postMessage({showEtag:h.at.etag,fromEtag:h.from.etag})}if(e.data.revisionDownloaded){var r=h.revisionFromEtag[e.data.revisionDownloaded];r.$.attr("downloaded",true);r.isDownloaded=true}if(e.data.revsionDiffed){h.needToRefindViewChildren=true;var r=h.revisionFromEtag[e.data.revsionDiffed];r.$.attr("diffed",true);r.isDiffed=true;var newStuff=e.data.newStuffForDom;for(var i=0;i<newStuff.length;i++){var lines=newStuff[i].lines.map(function(str){return str||" "});h.needToFixHeights=h.needToFixHeights.add(h.$view.insertClonedChildren(newStuff[i].at,h.$new_li,lines))}}if(e.data.vals_ui8buffer){if(h.needToRefindViewChildren){h.$rev_lines_=h.$view.children();h.needToRefindViewChildren=false}var $rl_=h.$rev_lines_;if(h.needToFixHeights.length){text_multi(h.$revisions_status,"Obtaining line height data...");h.needToFixHeights.fixHeightFromAuto();h.needToFixHeights=$([]);text_multi(h.$revisions_status,"Selecting lines...")}var vals=new Uint8Array(e.data.vals_ui8buffer);$rl_.setAttribute("v",function(i){return vals[i]});switch(e.data.digits){case 0:case 1:case 2:h.$view.setAttribute("digits","");break;case 3:h.$view.setAttribute("digits","###");break;case 4:h.$view.setAttribute("digits","####");break;default:h.$view.setAttribute("digits","#####")}}};"use strict";dn.find_goto_changed=function(new_value){if(new_value){dn.el.find_goto_wrapper.style.display="";dn.el.find_find_wrapper.style.display="none";dn.el.button_goto.classList.add("selected");dn.el.find_info.textContent="goto line inactive";dn.el.find_replace_wrapper.style.display="none"}else{dn.el.find_goto_wrapper.style.display="none";dn.el.find_find_wrapper.style.display="";dn.el.button_goto.classList.remove("selected");dn.el.find_info.textContent="search inactive";if(dn.g_settings.get("find_replace"))dn.el.find_replace_wrapper.style.display=""}};dn.find_replace_changed=function(new_value){if(new_value){dn.el.button_replace.classList.add("selected");if(!dn.g_settings.get("find_goto"))dn.el.find_replace_wrapper.style.display=""}else{dn.el.find_replace_wrapper.style.display="none";dn.el.button_replace.classList.remove("selected")}if(dn.find_inputs_have_focus)dn.find_select_result_idx(dn.find_current_match_idx)};dn.find_goto_input_has_focus=false;dn.find_goto_input_focus=function(){dn.find_goto_input_has_focus=true;dn.el.find_info.textContent="type to goto line";dn.find_perform_goto()};dn.find_goto_input_blur=function(e){dn.find_goto_input_has_focus=false;dn.el.find_info.textContent="goto line inactive";if(!e.relatedTarget)dn.focus_editor()};dn.find_perform_goto=function(){var validated_str=dn.el.find_goto_input.value.replace(/[^\d]/,"");if(validated_str!==dn.el.find_goto_input.value)dn.el.find_goto_input.value=validated_str;if(validated_str==="")return;var num=parseInt(validated_str);dn.editor.gotoLine(num);dn.editor.navigateLineEnd()};dn.find_goto_input_keyup=dn.find_perform_goto;dn.find_goto_input_keydown=function(e){if(e.which==WHICH.DOWN){dn.el.find_goto_input.value=parseInt(dn.el.find_goto_input.value.replace(/[^\d]/,""))+1;dn.find_perform_goto();e.preventDefault()}else if(e.which==WHICH.UP){dn.el.find_goto_input.value=parseInt(dn.el.find_goto_input.value.replace(/[^\d]/,""))-1;dn.find_perform_goto();e.preventDefault()}else if(e.which==WHICH.ESC){dn.g_settings.set("pane_open",false);e.preventDefault();e.stopPropagation()}};dn.find_inputs_have_focus=false;dn.find_results=[];dn.find_current_match_idx=-1;dn.find_markers=[];dn.find_marker_current=undefined;dn.find_str="";dn.find_inputs_focus=function(e){if(e.currentTarget==dn.el.find_input){dn.el.find_input.tabIndex=101;dn.el.find_replace_input.tabIndex=102}else{dn.el.find_input.tabIndex=102;dn.el.find_replace_input.tabIndex=101}if(dn.find_inputs_have_focus)return;dn.find_inputs_have_focus=true;dn.AceSearch=dn.AceSearch||ace.require("./search").Search;dn.AceRange=dn.AceRange||ace.require("./range").Range;dn.editor.setHighlightSelectedWord(false);dn.find_perform_search()};dn.find_inputs_blur=function(e){if(e.relatedTarget==dn.el.find_replace_input||e.relatedTarget==dn.el.find_input)return;dn.find_inputs_have_focus=false;var session=dn.editor.getSession();for(var ii=0;ii<dn.find_markers.length;ii++)session.removeMarker(dn.find_markers[ii]);if(dn.find_marker_current!==undefined){session.removeMarker(dn.find_marker_current);dn.find_marker_current=undefined}dn.el.find_info.textContent="search inactive";dn.el.find_results.innerHTML="";dn.el.find_info_overflow.textContent="";dn.find_markers=[];dn.find_results=[];dn.find_current_match_idx=-1;dn.el.find_input.setSelectionRange(dn.el.find_input.selectionEnd,dn.el.find_input.selectionEnd);dn.editor.setHighlightSelectedWord(true);if(!e.relatedTarget)dn.focus_editor()};dn.find_build_options=function(){var str=dn.el.find_input.value;var use_reg_exp=dn.g_settings.get("find_regex");var sensitive=dn.g_settings.get("find_case_sensitive");if(use_reg_exp){var re=undefined;re=new RegExp(str,sensitive?"g":"gi")}return{needle:use_reg_exp?re:str,wrap:true,caseSensitive:sensitive,wholeWord:dn.g_settings.get("find_whole_words"),regExp:use_reg_exp}};dn.find_perform_search=function(){var session=dn.editor.getSession();for(var ii=0;ii<dn.find_markers.length;ii++)session.removeMarker(dn.find_markers[ii]);if(dn.find_marker_current!==undefined){session.removeMarker(dn.find_marker_current);dn.find_marker_current=undefined}dn.find_markers=[];dn.find_results=[];dn.find_current_match_idx=-1;dn.el.find_results.innerHTML="";dn.el.find_info_overflow.textContent="";dn.el.find_info.textContent="";dn.find_str=dn.el.find_input.value;var search_options=undefined;try{search_options=dn.find_build_options()}catch(e){dn.el.find_info.textContent=escape_str(e.message)}if(search_options===undefined){dn.editor.selection.clearSelection()}else if(dn.find_str==""){dn.el.find_info.textContent="type to search. ";dn.editor.selection.clearSelection()}else{var search=new dn.AceSearch;search.setOptions(search_options);var results=dn.find_results=search.findAll(session);if(results.length===0){dn.el.find_info.textContent="no matches found.";dn.el.find_info_overflow.textContent="";dn.editor.selection.clearSelection()}else{var selected_range=session.getSelection().getRange();for(var ii=0;ii<results.length;ii++)if(results[ii].end.row>selected_range.start.row||results[ii].end.row==selected_range.start.row&&results[ii].end.column>=selected_range.start.column)break;var current_match_idx=ii==results.length?results.length-1:ii;for(var ii=0;ii<results.length;ii++)dn.find_markers.push(session.addMarker(results[ii],"find_match_marker","find_match_marker",false));for(var ii=0;ii<results.length;ii++)results[ii]={range:results[ii],idx:ii};dn.find_select_result_idx(current_match_idx)}}};dn.find_select_result_idx=function(current_match_idx){dn.find_current_match_idx=current_match_idx;var session=dn.editor.getSession();if(dn.find_marker_current!==undefined){session.removeMarker(dn.find_marker_current);dn.find_marker_current=undefined}var results=dn.find_results;var results_sub=[];var replace_is_showing=dn.g_settings.get("find_replace");var max_results=dn.find_max_results_half*2+(replace_is_showing?0:1);if(results.length<=max_results){results_sub=results}else{var n_pre=dn.find_max_results_half-(replace_is_showing?1:0);var n_post=dn.find_max_results_half;if(current_match_idx<n_pre){results_sub=results_sub.concat(results.slice(current_match_idx-n_pre));results_sub=results_sub.concat(results.slice(0,current_match_idx))}else{results_sub=results_sub.concat(results.slice(current_match_idx-n_pre,current_match_idx))}results_sub.push(results[current_match_idx]);if(current_match_idx+n_post>=results.length){results_sub=results_sub.concat(results.slice(current_match_idx+1));results_sub=results_sub.concat(results.slice(0,n_post+1-(results.length-current_match_idx)))}else{results_sub=results_sub.concat(results.slice(current_match_idx+1,current_match_idx+n_post+1))}}var show_replace_buttons=dn.g_settings.get("find_replace");var html="";for(var ii=0;ii<results_sub.length;ii++){var row=results_sub[ii].range.start.row;var col=results_sub[ii].range.start.column;var prefix_range=new dn.AceRange(row,Math.max(0,col-dn.find_max_prefix_chars),row,col);var pre_ellipses=col>dn.find_max_prefix_chars;row=results_sub[ii].range.end.row;col=results_sub[ii].range.end.column;var suffix_range=new dn.AceRange(row,col,row,col+dn.find_max_suffix_chars);html+="<div class='find_result_item"+(results_sub[ii].idx==current_match_idx?" find_result_current":"")+"'>"+"<div class='find_result_line_num'>"+(row+1)+"</div>"+"<div class='find_result_text'>"+"<div class='find_result_text_inner'>"+(pre_ellipses?"&#8230;":"")+escape_str(session.getTextRange(prefix_range))+"<span class='find_result_match'>"+escape_str(session.getTextRange(results_sub[ii].range))+"</span>"+escape_str(session.getTextRange(suffix_range))+"</div>"+"</div>"+(show_replace_buttons?"<div class='button inline_button replace_single_result' title='replace'>r</div>":"")+"</div>"}dn.el.find_results.innerHTML=html;var els=dn.el.find_results.getElementsByClassName("find_result_item");for(var ii=0;ii<els.length;ii++)if(results_sub[ii].idx!==current_match_idx)els[ii].addEventListener("click",dn.find_result_click(results_sub[ii].idx));if(show_replace_buttons){var els=dn.el.find_results.getElementsByClassName("replace_single_result");for(var ii=0;ii<els.length;ii++)els[ii].addEventListener("click",dn.find_replace_result_click(results_sub[ii].idx))}if(results.length>max_results)dn.el.find_info_overflow.textContent="... and "+(results.length-max_results)+" more matches";else dn.el.find_info_overflow.textContent="";dn.find_marker_current=session.addMarker(results[current_match_idx].range,"find_current_match_marker","find_current_match_marker",false);dn.editor.selection.setSelectionRange(results[current_match_idx].range,false);dn.editor.renderer.scrollSelectionIntoView()};dn.find_settings_changed=function(){if(dn.find_inputs_have_focus||dn.g_settings.get("pane")==="pane_find"&&dn.g_settings.get("pane_open")&&dn.el.find_input.value)dn.find_perform_search()};dn.find_result_click=function(ii){return function(e){dn.find_select_result_idx(ii)}};dn.find_replace_result_click=function(ii){return function(e){dn.find_replace_result_idx(ii);e.stopPropagation()}};dn.find_input_keyup=function(e){if(e.which==WHICH.ENTER||e.which==WHICH.ESC||e.which==WHICH.UP||e.which==WHICH.DOWN)return;if(dn.find_str==dn.el.find_input.value)return;dn.find_perform_search()};dn.find_input_keydown=function(e){if(e.which==WHICH.ENTER&&!e.shiftKey||!e.ctrlKey&&e.which==WHICH.DOWN){dn.find_select_result_idx(dn.find_current_match_idx+1<dn.find_results.length?dn.find_current_match_idx+1:0);e.preventDefault();return}else if(e.which==WHICH.ENTER&&e.shiftKey||!e.ctrlKey&&e.which==WHICH.UP){dn.find_select_result_idx(dn.find_current_match_idx-1<0?dn.find_results.length-1:dn.find_current_match_idx-1);e.preventDefault();return}if(e.which==WHICH.ESC){dn.g_settings.set("pane_open",false);e.preventDefault();e.stopPropagation();return}};dn.find_replace_input_keydown=function(e){if(e.which==WHICH.ENTER){if(e.ctrlKey||e.shiftKey)dn.find_replace_all();else dn.find_replace_result_idx(dn.find_current_match_idx);e.preventDefault()}else{dn.find_input_keydown(e)}};dn.find_replace_all=function(e){try{var options=dn.find_build_options()}catch(e){dn.show_error(e.message);return}dn.editor.replaceAll(dn.el.find_replace_input.value,options);dn.focus_editor()};dn.find_replace_click=dn.find_replace_all;dn.find_replace_result_idx=function(idx){var range=dn.find_results[idx].range;dn.editor.$search.set(dn.find_build_options());dn.editor.$tryReplace(range,dn.el.find_replace_input.value);dn.find_perform_search()};"use strict";dn.platform=function(){if(navigator.platform.indexOf("Win")>-1)return"Windows";else if(navigator.platform.indexOf("Linux")>-1)return"Linux";else if(navigator.platform.indexOf("Mac")>-1)return"Mac";return null}();dn.create_pane_shortcuts=function(){var arry=dn.shortcuts_list;var dict={};var platform=dn.platform;if(platform=="Windows"||platform=="Linux"){for(var i=0;i<arry.length;i++){var parts=arry[i].split("|");if(parts[1].length)dict[parts[0]]=parts[1]}}else if(platform=="Mac"){for(var i=0;i<arry.length;i++){var parts=arry[i].split("|");if(parts[1].length)dict[parts[0]]=parts.length>2?parts[2]:parts[1]}}else{}var html=[];for(var action in dict)html.push("<div class='shortcut_item'><div class='shortcut_action'>"+action+"</div><div class='shortcut_key'>"+dict[action].replace(",","<br>")+"</div></div>");for(var action in dn.tooltip_info)if(action in dict)dn.tooltip_info[action]+=dict[action];dn.el.pane_help_shortcuts.innerHTML=["<div class='widget_box_title shortcuts_title'>Keyboard Shortcuts ",platform?"("+platform+")":"","</div>","<div class='shortcuts_header_action'>action</div><div class='shortcuts_header_key'>key</div>","<div class='shortcuts_list'>",html.join(""),"</div>"].join("")};dn.esc_pressed=function(e){dn.g_settings.set("pane_open",!dn.g_settings.get("pane_open"));if(dn.g_settings.get("pane_open")&&dn.g_settings.get("pane")=="pane_find")if(dn.g_settings.get("find_goto"))dn.el.find_goto_input.focus();else dn.el.find_input.focus();
e.preventDefault()};dn.find_shortcut_used=function(e){var sel=dn.editor.session.getTextRange(dn.editor.getSelectionRange());dn.g_settings.set("find_goto",false);dn.g_settings.set("pane","pane_find");dn.g_settings.set("pane_open",true);if(sel){dn.el.find_input.value=sel;dn.el.find_input.select()}dn.el.find_input.focus();e.preventDefault()};dn.find_goto_shortcut_used=function(e){dn.g_settings.set("find_goto",true);dn.g_settings.set("pane","pane_find");dn.g_settings.set("pane_open",true);dn.el.find_goto_input.focus();e.preventDefault()};dn.show_replace_shortcut_used=function(e){dn.g_settings.set("find_replace",true);dn.find_shortcut_used(e)};dn.make_keyboard_shortcuts=function(){dn.editor.commands.removeCommands(["find","findprevious","findnext","replace","jumptomatching","sortlines","selecttomatching","gotoline"]);key("command+s, ctrl+s,  ctrl+alt+s,  command+alt+s",dn.save_content);key("command+p, ctrl+p,  ctrl+alt+p,  command+alt+p",dn.do_print);key("command+o, ctrl+o,  ctrl+alt+o,  command+alt+o",dn.do_open);key("command+n, ctrl+n,  ctrl+alt+n,  command+alt+n",dn.do_new);key("command+l, ctrl+l,  ctrl+alt+l,  command+alt+l",dn.find_goto_shortcut_used);key("command+f, ctrl+f,  ctrl+alt+f,  command+alt+f",dn.find_shortcut_used);key("command+r, ctrl+r,  ctrl+alt+r,  command+alt+r"+", command+g, ctrl+g,  ctrl+alt+g,  command+alt+g",dn.show_replace_shortcut_used);key("command+h, ctrl+h,  ctrl+alt+h,  command+alt+h",dn.start_revisions_worker);key("esc",dn.esc_pressed);key.filter=function(){return 1};var HashHandler=require("ace/keyboard/hash_handler").HashHandler;var extraKeyEvents=new HashHandler([{bindKey:{win:"Ctrl-Left",mac:"Command-Left"},descr:"Clipboard cyle back on paste",exec:dn.document_clipboard_left},{bindKey:{win:"Ctrl-Down",mac:"Command-Down"},descr:"Clipboard cyle back on paste",exec:dn.document_clipboard_left},{bindKey:{win:"Ctrl-Right",mac:"Command-Right"},descr:"Clipboard cyle forward on paste",exec:dn.document_clipboard_right},{bindKey:{win:"Ctrl-Up",mac:"Command-Up"},descr:"Clipboard cyle forward on paste",exec:dn.document_clipboard_right}]);dn.editor.keyBinding.addKeyboardHandler(extraKeyEvents);dn.ctrl_key="crtl";if(dn.platform=="Mac"){dn.ctrl_key="cmd";var els=dn.getElementsByClassName("ctrl_key");for(var ii=0;ii<els.length;ii++)els[ii].textContent="cmd"}};"use strict";dn.version_str="2016a";dn.can_show_drag_drop_error=true;dn.is_showing_history=false;dn.status={file_body:0,file_meta:0,file_sharing:0,authentication:0,popup_active:0,local_settings:0};dn.the_file={file_id:null,folder_id:null,title:null,description:"",ext:"",loaded_mime_type:"",new_line_detected:"none",tab_detected:{val:"none"},is_pristine:true,mime_type:"",is_saving:false,data_to_save:{body:null,title:null,description:null},generation_to_save:{body:0,title:0,description:0},is_read_only:false,is_shared:false,is_brand_new:false,is_reading_file_object:false,custom_props:{},custom_prop_exists:{},saving_title_count:0};dn.change_line_history=[];dn.last_change=null;dn.change_line_classes=function(rootStr,trueN,factor){var x=[""];for(var i=trueN;i;i--)for(var k=0;k<factor;k++)x.push(rootStr+i);return x}("recent_line_",8,5);dn.change_line_classes_rm=function(rootStr,trueN,factor){var x=[""];for(var i=trueN;i;i--)for(var k=0;k<factor;k++)x.push(rootStr+i);return x}("recent_line_rm",8,5);dn.el=dn.el||{};dn.authentication_done=function(auth_result){dn.status.popup_active=0;if(!auth_result)return dn.authentication_failed(null);if(auth_result.error)return dn.authentication_failed(auth_result.error);dn.status.authentication=1;dn.show_status();if(!dn.user_info)dn.get_user_info();if(dn.the_file.file_id&&dn.status.file_meta!=1||dn.status.file_body!=1)dn.load_file();dn.get_properties_from_cloud();gapi.load("drive-realtime",dn.get_settings_from_cloud());gapi.load("drive-share",function(){dn.el.share_dialog=new gapi.drive.share.ShareClient(dn.client_id)})};dn.get_user_info=function(){Promise.resolve(gapi.client.request({path:"userinfo/v2/me?fields=name"})).then(function(a){dn.user_info=a.result;dn.el.user_name.textContent=a.result.name},function(err){dn.show_error("Failed to get user info");console.dir(err)})};dn.authentication_failed=function(err){dn.status.authorization=-1;dn.status.popup_active=0;dn.show_status();if(err)dn.show_error(err.result.error.message);else dn.show_pane_permissions()};dn.reauth=function(callback){dn.status.authentication=0;dn.show_status();gapi.auth.authorize(dn.auth_map(true),function(){dn.status.authentication=1;dn.show_status();callback()})};dn.launch_popup=function(){dn.status.popup_active=1;dn.status.authorization=0;dn.show_status();Promise.resolve(gapi.auth.authorize(dn.auth_map(false))).then(dn.authentication_done,dn.authentication_failed)};dn.show_pane_permissions=function(){dn.g_settings.set("pane","pane_permissions");dn.g_settings.set("pane_open","true");css_animation(dn.el.the_widget,"shake",function(){},dn.error_delay_ms)};dn.do_share=function(){if(!dn.the_file.file_id){dn.show_error("You cannot view/modify the sharing settings until you have saved the file.");return false}dn.status.file_sharing=-1;dn.the_file.is_shared=0;dn.show_status();dn.el.share_dialog.setItemIds([dn.the_file.file_id]);dn.el.share_dialog.setOAuthToken(gapi.auth.getToken().access_token);dn.el.share_dialog.showSettingsDialog();return false};dn.detect_new_line=function(str){dn.the_file.new_line_detected=function(){var first_n=str.indexOf("\n");if(first_n==-1)return dn.show_newline_status("none");var has_rn=str.indexOf("\r\n")!=-1;var has_solo_n=str.match(/[^\r]\n/)?true:false;if(has_rn&&!has_solo_n)return dn.show_newline_status("windows");if(has_solo_n&&!has_rn)return dn.show_newline_status("unix");return dn.show_newline_status("mixed")}()};dn.apply_newline_choice=function(str){var newlineDefault=dn.g_settings.get("newLineDefault");if(newlineDefault=="windows"){dn.el.newline_menu_windows.classList.add("selected");dn.el.newline_menu_unix.classList.remove("selected")}else{dn.el.newline_menu_unix.classList.add("selected");dn.el.newline_menu_windows.classList.remove("selected")}if(typeof str=="string")dn.detect_new_line(str);dn.show_newline_status(dn.the_file.new_line_detected);dn.el.file_newline_detect.classList.remove("selected");dn.el.file_newline_windows.classList.remove("selected");dn.el.file_newline_unix.classList.remove("selected");if(dn.the_file.custom_props.newline=="detect"){if(dn.the_file.new_line_detected=="windows"||dn.the_file.new_line_detected=="unix")dn.editor.session.setNewLineMode(dn.the_file.new_line_detected);else dn.editor.session.setNewLineMode(newlineDefault);dn.el.file_newline_detect.classList.add("selected")}else{dn.editor.session.setNewLineMode(dn.the_file.custom_props.newline);if(dn.the_file.custom_props.newline=="windows")dn.el.file_newline_windows.classList.add("selected");else dn.el.file_newline_unix.classList.add("selected")}};dn.show_newline_status=function(statusStr){var str;switch(statusStr){case"none":str="no newlines detected, default is "+dn.g_settings.get("newLineDefault")+"-like";break;case"mixed":str="mixture of newlines detected, default is "+dn.g_settings.get("newLineDefault")+"-like";break;default:str="detected "+statusStr+"-like newlines"}dn.el.file_newline_info.textContent="("+str+")";return statusStr};dn.new_window_content="<html><head><script>";dn.open_button_click=function(){gapi.load("picker",function(){var view=new google.picker.View(google.picker.ViewId.DOCS);try{if(!dn.open_picker){dn.open_picker=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(dn.client_id).setOAuthToken(gapi.auth.getToken().access_token).addView(view).setCallback(dn.picker_callback).build();if(!dn.open_picker)throw"could not build picker"}dn.open_picker.setVisible(true)}catch(e){dn.show_error(""+e)}})};dn.picker_callback=function(data){if(data.action==google.picker.Action.PICKED){var file_id=data.docs[0].id;var url="?state="+JSON.stringify({action:"open",userId:dn.url_user_id,ids:[file_id]});window.location=url}else if(data.action=="cancel"){if(dn.open_new_tab)dn.open_new_tab.close();dn.focus_editor()}dn.open_new_tab=undefined};dn.show_help_inner=function(inner_pane){dn.el.pane_help_shortcuts.style.display="none";dn.el.pane_help_tips.style.display="none";dn.el.pane_help_main.style.display="none";dn.el.button_shortcuts.classList.remove("selected");dn.el.button_tips.classList.remove("selected");if(inner_pane=="tips"){dn.el.pane_help_tips.style.display="";dn.el.button_tips.classList.add("selected")}else if(inner_pane=="shortcuts"){dn.el.pane_help_shortcuts.style.display="";dn.el.button_shortcuts.classList.add("selected")}else{dn.el.pane_help_main.style.display=""}};dn.show_pane=function(id){var el=document.getElementById(id);for(var ii=0;ii<dn.el.widget_content.children.length;ii++)if(dn.el.widget_content.children[ii]!==el){dn.el.widget_content.children[ii].style.display="none";var el_icon=dn.menu_icon_from_pane_id[dn.el.widget_content.children[ii].id];if(el_icon)el_icon.classList.remove("icon_selected")}if(el){el.style.display="";var el_icon=dn.menu_icon_from_pane_id[el.id];if(el_icon)el_icon.classList.add("icon_selected")}else{dn.g_settings.set("pane_open",false)}};dn.widget_mouse_down=function(e){dn.widget_mouse_down_info={off_left:-e.clientX,off_top:-e.clientY,start_time:Date.now(),is_dragging:e.button!==0};document.addEventListener("mousemove",dn.document_mouse_move_widget);document.addEventListener("mouseup",dn.document_mouse_up_widget)};dn.document_mouse_move_widget=function(e){var x=e.clientX+dn.widget_mouse_down_info.off_left;var y=e.clientY+dn.widget_mouse_down_info.off_top;if(!dn.widget_mouse_down_info.is_dragging){dn.widget_mouse_down_info.is_dragging=Date.now()-dn.widget_mouse_down_info.start_time>dn.drag_delay_ms||x*x+y*y>dn.drag_shift_px*dn.drag_shift_px}if(dn.widget_mouse_down_info.is_dragging)translate(dn.el.the_widget,x,y);e.stopPropagation()};dn.document_mouse_up_widget=function(e){document.removeEventListener("mousemove",dn.document_mouse_move_widget);document.removeEventListener("mouseup",dn.document_mouse_up_widget);if(dn.widget_mouse_down_info.is_dragging){var pos=dn.el.the_widget.getBoundingClientRect();translate(dn.el.the_widget,0,0);var widget_w=dn.el.the_widget.offsetWidth;var widget_h=dn.el.the_widget.offsetHeight;var window_w=window.innerWidth;var window_h=window.innerHeight;var anchor=[];if(pos.left<window_w-(pos.left+widget_w)){anchor[0]="l";anchor[1]=Math.max(0,pos.left/window_w*100)}else{anchor[0]="r";anchor[1]=Math.max(0,(window_w-(pos.left+widget_w))/window_w*100)}if(pos.top<window_h-(pos.top+widget_h)){anchor[2]="t";anchor[3]=Math.max(0,pos.top/window_h*100)}else{anchor[2]="b";anchor[3]=Math.max(0,(window_h-(pos.top+widget_h))/window_h*100)}if(dn.g_settings)dn.g_settings.set("widget_anchor",anchor)}else{dn.g_settings.set("pane_open",!dn.g_settings.get("pane_open"))}dn.widget_mouse_down_info=undefined};dn.widget_apply_anchor=function(anchor){anchor=Array.isArray(anchor)?anchor:dn.g_settings.get("widget_anchor");var widget_w=dn.el.the_widget.offsetWidth;var widget_h=dn.el.the_widget.offsetHeight;var window_w=window.innerWidth;var window_h=window.innerHeight;if(anchor[0]=="l"){if(window_w*anchor[1]/100+widget_w>window_w){dn.el.the_widget.style.left="inherit";dn.el.the_widget.style.right="0px"}else{dn.el.the_widget.style.left=anchor[1]+"%";dn.el.the_widget.style.right=""}dn.el.widget_menu.classList.add("flipped");dn.el.widget_content.classList.add("flipped");var els=document.getElementsByClassName("widget_menu_icon");for(var ii=0;ii<els.length;ii++)els[ii].classList.add("flipped")}else{if(window_w*anchor[1]/100+widget_w>window_w){dn.el.the_widget.style.left="0px";dn.el.the_widget.style.right=""}else{dn.el.the_widget.style.left="inherit";dn.el.the_widget.style.right=anchor[1]+"%"}dn.el.widget_menu.classList.remove("flipped");dn.el.widget_content.classList.remove("flipped");var els=document.getElementsByClassName("widget_menu_icon");for(var ii=0;ii<els.length;ii++)els[ii].classList.remove("flipped")}if(anchor[2]=="t"){if(window_h*anchor[3]/100+widget_h>window_h){dn.el.the_widget.style.top="inherit";dn.el.the_widget.style.bottom="0px"}else{dn.el.the_widget.style.top=anchor[3]+"%";dn.el.the_widget.style.bottom=""}}else{if(window_h*anchor[3]/100+widget_h>window_h){dn.el.the_widget.style.top="0px";dn.el.the_widget.style.bottom=""}else{dn.el.the_widget.style.top="inherit";dn.el.the_widget.style.bottom=anchor[3]+"%"}}};dn.toggle_widget=function(state){if(state){dn.el.widget_menu.style.display="";dn.el.widget_content.style.display=""}else{dn.el.widget_menu.style.display="none";dn.el.widget_content.style.display="none"}};dn.show_status=function(){var s="";if(dn.status.authentication!=1){if(dn.status.authorization==-1)s="Authorization required...";else if(dn.status.popup_active)s="Login/authenticate with popup...";else s="Authenticating..."}else if(dn.the_file.file_id){if(dn.status.file_meta===1&&dn.status.file_body===1){s=dn.the_file.title;var extra=[];if(dn.the_file.is_read_only)extra.push("read-only");if(dn.the_file.is_shared)extra.push("shared");if(dn.status.file_sharing==-1)extra.push("sharing status unknown");if(!dn.the_file.is_pristine)extra.push("unsaved changes");if(extra.length)s+="\n["+extra.join(", ")+"]"}else if(dn.status.file_meta===0&&dn.status.file_body===0)s="Loading file:\n"+dn.the_file.file_id;else if(dn.status.file_meta===1&&dn.status.file_body===0)s="Loading "+(dn.the_file.is_read_only?"read-only ":"")+"file:\n"+dn.the_file.title;else if(dn.status.file_meta===0&&dn.status.file_body===1)s="Loading metadata for file:\n"+dn.the_file.file_id;else if(dn.status.file_meta===1)s="Failed to download "+(dn.the_file.is_read_only?"read-only ":"")+"file:\n"+dn.the_file.title;else if(dn.status.file_body===1)s="Failed to download metadata for file:\n"+dn.the_file.file_id;else s="Failed to load file:\n"+dn.the_file.file_id}else{s="ex nihilo omnia..."}text_multi(dn.el.widget_text,s,true)};dn.show_error=function(message){console.log(message);text_multi(dn.el.widget_error_text,message,true);dn.el.widget_error.style.display="";css_animation(dn.el.the_widget,"shake",function(){dn.el.widget_error.style.display="none"},dn.error_delay_ms)};dn.set_drive_link_to_folder=function(){var els=document.getElementsByClassName("link_drive");var href=dn.the_file.folder_id?"https://drive.google.com/#folders/"+dn.the_file.folder_id:"https://drive.google.com";for(var ii=0;ii<els.length;ii++)els[ii].href=href};dn.get_settings_from_cloud=function(){return;gapi.drive.realtime.loadAppDataDocument(function(doc){var old_temp_g_settings=dn.g_settings;dn.g_settings=doc.getModel().getRoot();dn.g_clipboard=dn.g_settings.get("clipboard");if(!dn.g_clipboard){dn.g_settings.set("clipboard",doc.getModel().createList());dn.g_clipboard=dn.g_settings.get("clipboard")}dn.g_find_history=dn.g_settings.get("findHistory");if(!dn.g_find_history){dn.g_settings.set("findHistory",doc.getModel().createList());dn.g_find_history=dn.g_settings.get("findHistory")}var existingKeys=dn.g_settings.keys();dn.g_settings.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,dn.settings_changed);console.log("Applying settings from cloud...");for(var s in dn.default_settings)if(s in old_temp_g_settings.getKeeps())dn.g_settings.set(s,old_temp_g_settings.get(s));else if(existingKeys.indexOf(s)==-1)dn.g_settings.set(s,dn.default_settings[s]);else if(JSON.stringify(old_temp_g_settings.get(s))!==JSON.stringify(dn.g_settings.get(s)))dn.settings_changed({property:s,newValue:dn.g_settings.get(s)});if(dn.g_settings.get("lastDNVersionUsed")!=dn.version_str){dn.g_settings.set("help_inner","tips");dn.g_settings.set("pane","pane_help");dn.g_settings.set("pane_open","true");dn.g_settings.set("lastDNVersionUsed",dn.version_str)}},null,function(resp){console.log("g_settings error");console.dir(arguments);if(resp.type&&resp.type=="token_refresh_required"||resp.error.code==401)dn.reauth(function(){console.log("reauthed triggered by g_settings")})})};dn.load_default_settings=function(){dn.g_settings=function(){var ob={};var keeps={};return{get:function(k){return ob[k]},set:function(k,v){if(ob[k]===v)return;ob[k]=v;dn.settings_changed({property:k,newValue:v})},keep:function(k){keeps[k]=true},getKeeps:function(){return keeps}}}();dn.status.local_settings=0;try{console.log("Loading default/localStorage settings...");for(var s in dn.default_settings)if(dn.impersonal_settings_keys.indexOf(s)==-1||!localStorage||!localStorage["g_settings_"+s])dn.g_settings.set(s,dn.default_settings[s]);else dn.g_settings.set(s,JSON.parse(localStorage["g_settings_"+s]))}catch(err){if(localStorage)localStorage.clear();console.log("Failed to load defaults/localStorage settings.  Have cleared localStorage cache.")}dn.status.local_settings=1};dn.settings_changed=function(e){var new_value=e.newValue;console.log("[user settings] "+e.property+": "+new_value);if(dn.impersonal_settings_keys.indexOf(e.property)>-1&&localStorage){localStorage["g_settings_"+e.property]=JSON.stringify(new_value)}try{switch(e.property){case"widget_anchor":dn.widget_apply_anchor(new_value);break;case"theme":dn.editor.setTheme("ace/theme/"+new_value);dn.theme_drop_down.SetInd(dn.theme_drop_down.IndexOf(new_value),true);break;case"fontSize":var scrollLine=dn.get_scroll_line();dn.el.font_size_text.textContent=new_value.toFixed(1);dn.editor.setFontSize(new_value+"em");dn.editor.scrollToLine(scrollLine);break;case"wordWrap":var s=dn.editor.getSession();var scrollLine=dn.get_scroll_line();s.setUseWrapMode(new_value[0]);s.setWrapLimitRange(new_value[1],new_value[2]);dn.editor.scrollToLine(scrollLine);if(!new_value[0])dn.el.word_wrap_off.classList.add("selected");else dn.el.word_wrap_off.classList.remove("selected");if(new_value[0]&&!new_value[1])dn.el.word_wrap_edge.classList.add("selected");else dn.el.word_wrap_edge.classList.remove("selected");if(new_value[0]&&new_value[1])dn.el.word_wrap_at.classList.add("selected");else dn.el.word_wrap_at.classList.remove("selected");break;case"wordWrapAt":dn.el.word_wrap_at_text.textContent=new_value;var curWrap=dn.g_settings.get("wordWrap");if(curWrap[1]&&curWrap[1]!=new_value)dn.g_settings.set("wordWrap",[1,new_value,new_value]);dn.editor.setPrintMarginColumn(new_value);break;case"showGutterHistory":var s=dn.editor.getSession();if(new_value){dn.el.gutter_history_show.classList.add("selected");dn.el.gutter_history_hide.classList.remove("selected")}else{var h=dn.change_line_history;for(var i=0;i<h.length;i++)if(h[i])s.removeGutterDecoration(i,h[i]<0?dn.change_line_classes_rm[-h[i]]:dn.change_line_classes[h[i]]);dn.change_line_history=[];dn.el.gutter_history_hide.classList.add("selected");dn.el.gutter_history_show.classList.remove("selected")}break;case"newLineDefault":dn.apply_newline_choice();break;case"historyRemovedIsExpanded":dn.revision_setis_expaned(new_value);break;case"softTabN":case"tabIsHard":dn.apply_tab_choice();break;case"pane_open":dn.toggle_widget(new_value);if(dn.g_settings.keep)dn.g_settings.keep("pane_open");break;case"pane":dn.show_pane(new_value);if(dn.g_settings.keep)dn.g_settings.keep("pane");if(new_value!=="pane_help")dn.g_settings.set("help_inner","main");break;case"help_inner":dn.show_help_inner(new_value);break;case"find_regex":if(new_value)dn.el.find_button_regex.classList.add("selected");else dn.el.find_button_regex.classList.remove("selected");dn.find_settings_changed();break;case"find_whole_words":if(new_value)dn.el.find_button_whole_words.classList.add("selected");else dn.el.find_button_whole_words.classList.remove("selected");dn.find_settings_changed();break;case"find_case_sensitive":if(new_value)dn.el.find_button_case_sensitive.classList.add("selected");else dn.el.find_button_case_sensitive.classList.remove("selected");dn.find_settings_changed();break;case"find_replace":dn.find_replace_changed(new_value);break;case"find_goto":dn.find_goto_changed(new_value);break}}catch(err){console.log("Error while uptating new settings value.");console.dir(e);console.dir(err)}};dn.font_size_decrement_click=function(){var font_size=dn.g_settings.get("fontSize");font_size-=dn.font_size_increment;font_size=font_size<dn.min_font_size?dn.min_font_size:font_size;dn.g_settings.set("fontSize",font_size)};dn.font_size_increment_click=function(){var font_size=dn.g_settings.get("fontSize");font_size+=dn.font_size_increment;font_size=font_size>dn.max_font_size?dn.max_font_size:font_size;dn.g_settings.set("fontSize",font_size)};dn.detect_tab=function(str){dn.the_file.tab_detected=function(){var lines=dn.editor.session.getLines(0,1e3);var indents=lines.map(function(str){return str.match(/^\s*/)[0]});indents=indents.filter(function(str){return str!==""});if(!indents.length)return dn.show_tab_status({val:"none"});var stats=indents.reduce(function(stats,str){if(str.indexOf("	")>-1)if(str.indexOf(" ")>-1)stats.nWithMixture++;else stats.nWithOnlyTabs++;else stats.spaceHist[str.length]=(stats.spaceHist[str.length]||0)+1;return stats},{nWithOnlyTabs:0,spaceHist:[],nWithMixture:0});stats.nSamp=indents.length;stats.nWithOnlySpaces=stats.nSamp-stats.nWithMixture-stats.nWithOnlyTabs;console.dir(stats);if(stats.nWithOnlyTabs/stats.nSamp>=dn.detect_tabs_tabs_frac)return dn.show_tab_status({val:"tab"});if(stats.nWithOnlySpaces/stats.nSamp<dn.detect_tabs_spaces_frac)return dn.show_tab_status({val:"mixture"});stats.spaceModHist=[];var s;for(s=dn.min_soft_tab_n;s<=dn.max_soft_tab_n;s++){var m=0;for(var i=s;i<stats.spaceHist.length;i+=s)m+=stats.spaceHist[i]!==undefined?stats.spaceHist[i]:0;stats.spaceModHist[s]=m}for(s=dn.max_soft_tab_n;s>=dn.min_soft_tab_n;s--)if(stats.spaceModHist[s]/stats.nWithOnlySpaces>dn.detect_tabs_n_spaces_frac)break;if(s<dn.min_soft_tab_n){var defaultNSpaces=dn.g_settings.get("softTabN");if(stats.spaceModHist[defaultNSpaces]/stats.nWithOnlySpaces>dn.detect_tabs_n_spaces_frac_for_default)return dn.show_tab_status({val:"spaces",n:defaultNSpaces,isDefault:true,threshold:"weak"});else return dn.show_tab_status({val:"spaces",n:defaultNSpaces,isDefault:true,threshold:"failed"})}else{return dn.show_tab_status({val:"spaces",n:s,isDefault:false,threshold:"strong"})}}()};dn.show_tab_status=function(d){var str;var defaultStr="";if(dn.g_settings.get("tabIsHard"))defaultStr="hard tabs";else defaultStr=dn.g_settings.get("softTabN")+" spaces";switch(d.val){case"none":str="no indentations detected, default is "+defaultStr;break;case"mixture":str="detected mixture of tabs, default is "+defaultStr;break;case"tab":str="hard tab indentation detected";break;case"spaces":switch(d.threshold){case"strong":str="detected soft-tabs of "+d.n+" spaces";break;case"weak":str="detected close match to default of "+d.n+" spaces";break;case"failed":str="detected soft-tabs, assuming default "+d.n+" spaces";break}}dn.el.file_tab_info.textContent="("+str+")";return d};dn.apply_tab_choice=function(){var defaultTabIsHard=dn.g_settings.get("tabIsHard");var defaultSoftTabN=dn.g_settings.get("softTabN");var d;var isHard;var nSpaces;var isDetected;dn.detect_tab();if(dn.the_file.custom_props.tabs=="detect"){d=dn.the_file.tab_detected;isDetected=true}else{try{d=JSON.parse(dn.the_file.custom_props.tabs)}catch(err){d={val:"none"}}}switch(d.val){case"none":case"mixture":isHard=defaultTabIsHard;nSpaces=defaultSoftTabN;break;case"tab":isHard=true;nSpaces=d.n||defaultSoftTabN;break;case"spaces":isHard=false;nSpaces=d.n}if(isHard){dn.editor.session.setUseSoftTabs(false)}else{dn.editor.session.setUseSoftTabs(true);dn.editor.session.setTabSize(nSpaces)}dn.el.tab_soft_text.textContent=defaultSoftTabN;if(defaultTabIsHard){dn.el.tab_hard.classList.add("selected");dn.el.tab_soft.classList.remove("selected")}else{dn.el.tab_soft.classList.add("selected");dn.el.tab_hard.classList.remove("selected")}dn.el.file_tab_detect.classList.remove("selected");dn.el.file_tab_hard.classList.remove("selected");dn.el.file_tab_soft.classList.remove("selected");if(isDetected){dn.el.file_tab_detect.classList.add("selected");dn.el.file_tab_soft_text.textContent=nSpaces}else{if(d.val=="tab")dn.el.file_tab_hard.classList.add("selected");else dn.el.file_tab_soft.classList.add("selected");dn.el.file_tab_soft_text.textContent=nSpaces}};dn.set_file_tabs_to_soft_or_hard=function(val,delta){var f=dn.the_file;var current=f.custom_props.tabs;if(current=="detect"){current=f.tab_detected;if(current.val=="none"||current.val=="mixture")current={val:dn.g_settings.get("tabIsHard")?"tab":"spaces",n:dn.g_settings.get("softTabN")}}else{try{current=JSON.parse(current)}catch(err){console.log("JSON.parse failed in SetFileTabsToSoftOrHard with current="+current);return}}var newT={val:val,n:current.n+delta};dn.set_property("tabs",JSON.stringify(newT))};dn.show_syntax_status=function(d){var str="detected "+d.syntax+" from file extension";dn.el.file_ace_mode_info.textContent="("+str+")";return d.syntax};dn.detect_syntax=function(){dn.the_file.syntax_detected=function(){var title=dn.the_file.title||"untitled.txt";var mode=require("ace/ext/modelist").getModeForPath(title);dn.the_file.syntax_detected=mode.caption;dn.show_syntax_status({syntax:dn.the_file.syntax_detected});return mode}()};dn.apply_syntax_choice=function(){dn.detect_syntax();if(dn.the_file.custom_props["aceMode"]=="detect"){dn.set_syntax(dn.the_file.syntax_detected);dn.el.file_ace_mode_detect.classList.add("selected");dn.syntax_drop_down.SetSelected(false)}else{dn.set_syntax(dn.the_file.custom_props["aceMode"]);dn.el.file_ace_mode_detect.classList.remove("selected");dn.syntax_drop_down.SetSelected(true)}};dn.get_current_syntax_name=function(){try{var modesArray=require("ace/ext/modelist").modesByName;return modesArray[dn.editor.session.getMode().$id.split("/").pop()].caption}catch(e){console.log("ERROR in GetCurrentSyntaxName...");console.dir(e);return"Text"}};dn.set_syntax=function(val){var modesArray=require("ace/ext/modelist").modes;var mode;var ind;if(typeof val=="number"){mode=modesArray[val].mode;ind=val}else if(modesArray.indexOf(val)>-1){mode=val.mode;ind=modesArray.indexOf(val)}else{for(ind=0;ind<modesArray.length;ind++)if(modesArray[ind].caption==val){mode=modesArray[ind].mode;break}}if(dn.syntax_drop_down)dn.syntax_drop_down.SetInd(ind,true);dn.editor.getSession().setMode(mode)};dn.create_theme_menu=function(){var themes=require("ace/ext/themelist");var theme_drop_down=new DropDown(Object.keys(themes.themesByName));theme_drop_down.addEventListener("change",function(){dn.g_settings.set("theme",theme_drop_down.GetVal())});theme_drop_down.addEventListener("blur",function(){dn.focus_editor()});return theme_drop_down};dn.create_syntax_menu=function(){var modes=require("ace/ext/modelist").modes;var syntax_drop_down=new DropDown(modes.map(function(m){return m.caption}));syntax_drop_down.addEventListener("click",dn.read_only_bail);syntax_drop_down.addEventListener("click",function(){dn.set_property("aceMode",syntax_drop_down.GetVal())});syntax_drop_down.addEventListener("change",function(){dn.set_property("aceMode",syntax_drop_down.GetVal())});syntax_drop_down.addEventListener("blur",function(){dn.focus_editor()});return syntax_drop_down};dn.read_only_bail=function(e){if(dn.the_file.is_read_only){dn.show_error("The file is read-only, so you cannot change its properties.");e.stopImmediatePropagation();dn.focus_editor()}};dn.create_file_details_tool=function(){var els=[dn.el.details_title_text,dn.el.details_description_text,dn.el.file_newline_detect,dn.el.file_newline_windows,dn.el.file_newline_unix,dn.el.file_tab_detect,dn.el.file_tab_soft,dn.el.file_tab_hard,dn.el.file_ace_mode_detect];for(var ii=0;ii<els.length;ii++)els[ii].addEventListener("click",dn.read_only_bail);dn.el.details_title_text.addEventListener("click",function(){dn.el.details_title_text.style.display="none";dn.el.details_title_input.style.display="";dn.el.details_title_input.focus();dn.el.details_title_input.select()});dn.el.details_title_input.addEventListener("blur",function(){dn.el.details_title_input.style.display="none";dn.el.details_title_text.style.display="";var new_val=dn.el.details_title_input.value;if(new_val==dn.the_file.title)return;dn.the_file.title=new_val;dn.show_file_title();dn.apply_syntax_choice();dn.save_file_title();dn.focus_editor()});dn.el.details_title_input.addEventListener("keyup",function(e){if(e.which==WHICH.ENTER)dn.el.details_title_input.trigger("blur")});dn.el.details_title_input.addEventListener("keydown",function(e){if(e.which==WHICH.ESC){dn.el.details_title_input.value=dn.the_file.title;dn.el.details_title_input.trigger("blur");dn.ignore_escape=true}});dn.el.button_save.addEventListener("click",dn.save_content);dn.el.button_print.addEventListener("click",dn.do_print);dn.el.button_share.addEventListener("click",dn.do_share);dn.el.button_history.addEventListener("click",dn.start_revisions_worker);dn.el.details_description_text.addEventListener("click",function(){dn.el.details_description_text.style.display="none";dn.el.details_description_input.style.display="";dn.el.details_description_input.focus()});dn.el.details_description_input.addEventListener("blur",function(){dn.el.details_description_input.style.display="none";dn.el.details_description_text.style.display="";var new_val=dn.el.details_description_input.value;if(dn.the_file.description===new_val)return;dn.the_file.description=new_val;dn.show_description();dn.save_file_description();dn.focus_editor()});dn.el.details_description_input.addEventListener("keydown",function(e){if(e.which==WHICH.ESC){dn.el.details_description_input.value=dn.the_file.description;dn.el.details_description_input.trigger("blur");dn.ignore_escape=true}});dn.el.file_newline_detect.addEventListener("click",function(){dn.set_property("newline","detect");dn.focus_editor()});dn.el.file_newline_windows.addEventListener("click",function(){dn.set_property("newline","windows");dn.focus_editor()});dn.el.file_newline_unix.addEventListener("click",function(){dn.set_property("newline","unix");dn.focus_editor()});dn.el.file_tab_detect.classList.add("selected");dn.el.file_tab_detect.addEventListener("click",function(){dn.set_property("tabs","detect");dn.focus_editor()});dn.el.file_tab_soft.addEventListener("click",function(){dn.set_file_tabs_to_soft_or_hard("spaces",0);dn.focus_editor()});document.getElementById("file_tab_soft_dec").addEventListener("click",function(){dn.set_file_tabs_to_soft_or_hard("spaces",-1);dn.focus_editor()});document.getElementById("file_tab_soft_inc").addEventListener("click",function(){dn.set_file_tabs_to_soft_or_hard("spaces",+1);dn.focus_editor()});dn.el.file_tab_hard.addEventListener("click",function(){dn.set_file_tabs_to_soft_or_hard("tab",0);dn.focus_editor()});dn.el.file_ace_mode_detect.addEventListener("click",function(){dn.set_property("aceMode","detect")})};dn.save_file_description=function(){if(dn.the_file.is_brand_new){dn.save_new_file();return}dn.save_file(dn.the_file.file_id,{description:dn.the_file.description},undefined,$.proxy(dn.save_done,{description:++dn.the_file.generation_to_save.description}));dn.show_status();return};dn.save_file_title=function(){if(dn.the_file.is_brand_new){dn.save_new_file();return}dn.save_file(dn.the_file.file_id,{title:dn.the_file.title},undefined,$.proxy(dn.save_done,{title:++dn.the_file.generation_to_save.title}));dn.show_status()};dn.show_file_title=function(){dn.el.details_title_text.textContent="Title: "+dn.the_file.title;dn.el.details_title_input.value=dn.the_file.title;document.title=(dn.the_file.is_pristine?"":"*")+dn.the_file.title;dn.show_status()};dn.show_description=function(){text_multi(dn.el.details_description_text,"Description: "+dn.the_file.description,true);dn.el.details_description_input.value=dn.the_file.description};dn.save_content=function(){if(dn.the_file.is_brand_new){dn.save_new_file();return false}if(!dn.the_file.is_pristine){dn.the_file.data_to_save.body=dn.editor.getSession().getValue();dn.the_file.generation_to_save.body++;dn.el.ace_content.setAttribute("saving",true);dn.the_file.is_saving=true;dn.the_file.is_pristine=true}dn.show_file_title();dn.do_save();return false};dn.do_save=function(){if(dn.the_file.is_read_only){dn.show_error("Cannot save read-only file.");
return false}if(!(dn.the_file.data_to_save.body||dn.the_file.data_to_save.title||dn.the_file.data_to_save.description)){dn.show_error("No changes since last save.");return false}var gens={};var body,meta;if(dn.the_file.data_to_save.body){body=dn.the_file.data_to_save.body;gens.body=dn.the_file.generation_to_save.body}if(dn.the_file.data_to_save.title||dn.the_file.data_to_save.description){meta={};if(dn.the_file.data_to_save.title){meta.title=dn.the_file.data_to_save.title;gens.title=dn.the_file.generation_to_save.title}if(dn.the_file.data_to_save.description){meta.description=dn.the_file.data_to_save.description;gens.description=dn.the_file.generation_to_save.description}}dn.save_file(dn.the_file.file_id,meta,body,$.proxy(dn.save_done,gens));return false};dn.save_done=function(resp){if(resp.error){if(resp.error.code==401){dn.reauth(dn.do_save)}else{var failures=[];if(this.body&&this.body==dn.the_file.generation_to_save.body){failures.push("body");dn.the_file.is_saving=false;dn.the_file.is_pristine=false;dn.show_file_title();dn.el.ace_content.removeAttribute("saving");dn.the_file.data_to_save.body=null}if(this.title&&this.title==dn.the_file.generation_to_save.title)failures.push("title");if(this.description&&this.description==dn.the_file.generation_to_save.description)failures.push("description");if(failures.length){dn.show_error("Failed to save "+oxford_comma(failures)+". Error #"+resp.error.code+(resp.error.message?"\n"+resp.error.message:""));console.dir(resp)}}}else{if(this.body&&this.body==dn.the_file.generation_to_save.body){dn.the_file.is_saving=false;dn.el.ace_content.removeAttribute("saving");dn.the_file.ext=resp.fileExtension;dn.g_settings.set("ext",resp.fileExtension);dn.the_file.data_to_save.body=null;if(dn.the_file.is_brand_new)dn.saved_new_file(resp)}if(this.title&&this.title==dn.the_file.generation_to_save.title){dn.the_file.data_to_save.title=null}if(this.description&&this.description==dn.the_file.generation_to_save.description){dn.the_file.data_to_save.description=null}}dn.show_status()};dn.save_file=function(fileId,fileMetadata,fileText,callback){var boundary=dn.make_boundary();var delimiter="\r\n--"+boundary+"\r\n";var close_delim="\r\n--"+boundary+"--";var messageBody=delimiter+"Content-Type: application/json\r\n"+"\r\n"+JSON.stringify(fileMetadata?fileMetadata:{});if(fileText){messageBody+=delimiter+"Content-Type: application/octet-stream\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+btoa(unescape(encodeURIComponent(fileText)))}messageBody+=close_delim;var request=gapi.client.request({path:"/upload/drive/v2/files/"+(fileId?fileId:""),method:fileId?"PUT":"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:messageBody});request.execute(callback)};dn.make_boundary=function(){return(new Date).getTime()+""+Math.random()*10};dn.do_print=function(){var content=dn.editor.session.doc.getAllLines();var html=Array(content.length);for(var i=0;i<content.length;i++)html[i]="<li><div class='printline'>"+dn.line_to_html(i)+"</div></li>";var printWindow=window.open("","");printWindow.document.writeln("<html><head><title>"+dn.the_file.title+"</title></head><style>"+ace.require("ace/theme/"+dn.g_settings.get("theme")).cssText+"\nbody{font-size:"+dn.g_settings.get("fontSize")*14+"px; white-space:pre-wrap;"+"font-family:'Monaco','Menlo','Ubuntu Mono','Droid Sans Mono','Consolas',monospace;}"+"\nli{color:gray;}\n.printline{color:black;}</style>"+"<body class='ace-"+dn.g_settings.get("theme").replace("_","-")+"'><ol id='content'>"+html.join("")+"</ol></body></html>");printWindow.print();return false};dn.line_to_html=function(n){var printLayer=Object.create(ace.require("ace/layer/text").Text.prototype);var tokens=dn.editor.getSession().getTokens(n);var html=[];var screenColumn=0;for(var i=0;i<tokens.length;i++){var token=tokens[i];var value=token.value.replace(/\t/g,"   ");if(value)printLayer.$renderToken(html,0,token,value)}return html.join("").replace(/&#160;/g," ")};dn.document_clipboard_left=function(){if(!dn.clipboard_active)return false;if(dn.clipboard_index<=0)return true;dn.clipboard_index--;dn.editor.undo();dn.editor.insert(dn.g_clipboard.get(dn.clipboard_index));return true};dn.document_clipboard_right=function(){if(!dn.clipboard_active)return false;if(dn.clipboard_index>=dn.g_clipboard.length-1)return true;dn.clipboard_index++;dn.editor.undo();dn.editor.insert(dn.g_clipboard.get(dn.clipboard_index));return true};dn.document_clipboard_keyup=function(e){if(e.which==17||e.which==91||!e.ctrlKey){$(document).off("keyup",dn.document_clipboard_keyup);dn.clipboard_active=false;dn.el.pane_clipboard.style.display="none";if(dn.clipboard_info_timer){clearTimeout(dn.clipboard_info_timer);dn.clipboard_info_timer=null}}};dn.on_paste=function(text){if(dn.g_clipboard===undefined)return;$(document).on("keyup",dn.document_clipboard_keyup);dn.clipboard_active=true;dn.clipboard_index=dn.g_clipboard.lastIndexOf(text);if(dn.clipboard_index==-1){dn.clipboard_index=dn.g_clipboard.push(text);while(dn.g_clipboard.length>dn.clipboard_max_length)dn.g_clipboard.remove(0)}if(dn.clipboard_info_timer)clearTimeout(dn.clipboard_info_timer);dn.clipboard_info_timer=setTimeout(function(){dn.clipboard_info_timer=null;dn.el.pane_clipboard.style.display=""},dn.clipboard_info_delay)};dn.on_copy=function(text){if(dn.g_clipboard===undefined)return;dn.g_clipboard.push(text);while(dn.g_clipboard.length>dn.clipboard_max_length)dn.g_clipboard.remove(0)};dn.create_clipboard_tool=function(){dn.el.pane_clipboard=document.getElementById("pane_clipboard");dn.el.button_clear_clipboard.addEventListener("click",function(){dn.g_clipboard.clear()});dn.el.button_clear_find_replace.addEventListener("click",function(){dn.g_find_history.clear()})};dn.do_new=function(){var base=window.location.href.match(/^https?:\/\/[\w-.]*\/\w*/)[0];window.open(base+"?state="+JSON.stringify({action:"create",folderId:dn.the_file.folder_id?dn.the_file.folder_id:"",ext:dn.g_settings.get("ext")}),"_blank");return false};dn.create_new_tool=function(){dn.el.menu_new.addEventListener("click",dn.do_new)};dn.create_file=function(){dn.apply_syntax_choice();dn.the_file.is_brand_new=true;dn.show_file_title();dn.show_description();dn.apply_newline_choice();dn.apply_tab_choice();dn.g_settings.set("pane","pane_file")};dn.guess_mime_type=function(){if(dn.the_file.loaded_mime_type)return dn.the_file.loaded_mime_type;var plain="text/plain";var ext=dn.the_file.title.match(/\.[0-9a-z]+$/i);if(!ext)return plain;else ext=ext[0].substr(1);return ext in dn.ext_to_mime_type?dn.ext_to_mime_type[ext]:plain};dn.save_new_file=function(){var f=dn.the_file;if(f.is_saving){dn.show_error("File is being created. Please wait.");return false}var meta={title:f.title,description:f.description,mimeType:dn.guess_mime_type()};var parentId=f.folderId;if(parentId)meta.parentNodes=[{id:[parentId]}];f.data_to_save.body=dn.editor.getSession().getValue();f.data_to_save.title=meta.title;f.data_to_save.description=meta.description;var gens={title:++f.generation_to_save.title,description:++f.generation_to_save.description,body:++f.generation_to_save.body};f.is_saving=true;f.is_pristine=true;dn.show_file_title();dn.el.ace_content.setAttribute("saving",true);dn.show_status();dn.save_file(null,meta,f.data_to_save.body,$.proxy(dn.save_done,gens))};dn.saved_new_file=function(resp){dn.the_file.is_brand_new=false;dn.the_file.file_id=resp.id;dn.the_file.is_shared=resp.shared;dn.status.file_sharing=1;dn.the_file.ext=resp.fileExtension;history.replaceState({},dn.the_file.title,window.location.href.match(/^https?:\/\/[\w-.]*\/\w*/)[0]+'?state={"action":"open","ids":["'+dn.the_file.file_id+'"]}');dn.set_drive_link_to_folder();dn.save_all_file_properties()};dn.save_scroll_line=function(){dn.patch_property(dn.the_file.file_id,"ScrollToLine",dn.get_scroll_line(),"PUBLIC",null)};dn.get_scroll_line=function(){return dn.editor.getSession().screenToDocumentPosition(dn.editor.renderer.getScrollTopRow(),0).row};dn.load_file=function(flag){var file_id=dn.the_file.file_id;dn.show_status();dn.status.file_meta=0;var promise_get_meta=Promise.resolve(gapi.client.request({path:"/drive/v3/files/"+file_id,params:{fields:"name,mimeType,description,parents,capabilities,fileExtension,shared"}})).then(dn.load_file_got_meta_data,function(err){dn.show_error(err.result.error.message);dn.status.file_meta=-1;dn.show_status();throw err});dn.status.file_body=0;var promise_get_body=Promise.resolve(gapi.client.request({path:"/drive/v3/files/"+file_id,params:{alt:"media"}})).then(dn.load_file_got_file_body,function(err){dn.show_error(err.result.error.message);dn.status.file_body=-1;dn.show_status();throw err});dn.pr_the_file=Promise.all([promise_get_meta,promise_get_body]).then(function(){},function(){document.title="Drive Notepad";dn.g_settings.set("pane","pane_help");dn.g_settings.set("pane_open",true)})};dn.load_file_got_meta_data=function(resp){if(resp.error)throw Error(resp.error);dn.the_file.title=resp.result.name;dn.the_file.description=resp.result.description||"";dn.show_description();dn.the_file.ext=resp.result.fileExtension;dn.the_file.is_read_only=!resp.result.capabilities.canEdit;dn.the_file.is_shared=resp.result.shared;dn.the_file.loaded_mime_type=resp.result.mimeType;if(resp.result.parents&&resp.result.parents.length){dn.the_file.folder_id=resp.result.parents[0];dn.set_drive_link_to_folder()}dn.show_file_title();dn.status.file_meta=1;dn.show_status()};dn.load_file_got_file_body=function(resp){dn.show_status();dn.setting_session_value=true;dn.editor.session.setValue(resp.body);dn.setting_session_value=false;dn.apply_newline_choice(resp.body);dn.apply_syntax_choice();dn.apply_tab_choice();dn.status.file_body=1;dn.show_status()};dn.on_change=function(e){if(!e.start||!e.end||dn.setting_session_value)return;if(dn.the_file.is_pristine){dn.the_file.is_pristine=false;dn.show_file_title();dn.show_status()}if(!dn.g_settings.get("showGutterHistory"))return;var nClasses=dn.change_line_classes.length-1;var h=dn.change_line_history;var s=dn.editor.getSession();var start_row=e.start.row;var end_row=e.end.row;if(dn.last_change&&dn.last_change.start_row==start_row&&dn.last_change.end_row==end_row&&start_row==end_row&&dn.last_change.action.indexOf("Text")!=-1&&e.action.indexOf("Text")!=-1){if(dn.last_change.action==e.action){return}else if(e.action=="removeText"){s.removeGutterDecoration(start_row,dn.change_line_classes[nClasses]);s.addGutterDecoration(start_row,dn.change_line_classes_rm[nClasses]);h[start_row]=-nClasses;dn.last_change.action="removeText";return}else{s.removeGutterDecoration(start_row,dn.change_line_classes_rm[nClasses]);s.addGutterDecoration(start_row,dn.change_line_classes[nClasses]);h[start_row]=nClasses;dn.last_change.action="insertText";return}}else{dn.last_change={start_row:start_row,end_row:end_row,action:e.action}}for(var i=0;i<h.length;i++)if(h[i])s.removeGutterDecoration(i,h[i]<0?dn.change_line_classes_rm[-h[i]++]:dn.change_line_classes[h[i]--]);if(e.action=="removeLines"){h.splice(start_row,end_row-start_row+1);h[start_row]=h[start_row+1]=-nClasses}else if(e.action==="removeText"){h[start_row]=-nClasses}else{var newLineCount=0;if(e.action=="insertText")newLineCount=(e.text.match(/\n/g)||[]).length;if(e.action=="insertLines")newLineCount=e.lines.length;h.splice.apply(h,[start_row,0].concat(Array(newLineCount)));for(var i=start_row;i<=end_row;i++)h[i]=nClasses}for(var i=0;i<h.length;i++)if(h[i])s.addGutterDecoration(i,h[i]<0?dn.change_line_classes_rm[-h[i]]:dn.change_line_classes[h[i]])};dn.query_unload=function(){if(!dn.the_file.is_pristine)return"If you leave the page now you will loose the unsaved "+(dn.the_file.is_brand_new?"new ":"changes to ")+"file '"+dn.the_file.title+"'."};dn.property_updated=function(propKey,new_val){console.log("[file custom property]  "+propKey+": "+new_val);switch(propKey){case"newline":dn.apply_newline_choice();break;case"tabs":dn.apply_tab_choice();break;case"aceMode":dn.apply_syntax_choice();break}};dn.load_default_properties=function(){for(var k in dn.default_custom_props)dn.set_property(k,dn.default_custom_props[k])};dn.get_properties_from_cloud=function(){};dn.got_all_file_properties=function(resp){if(resp.items){dn.the_file.custom_prop_exists={};for(var i=0;i<resp.items.length;i++){dn.the_file.custom_props[resp.items[i].key]=resp.items[i].value;dn.the_file.custom_prop_exists[resp.items[i].key]=true;dn.property_updated(resp.items[i].key,resp.items[i].value)}}};dn.save_all_file_properties=function(){for(var k in dn.the_file.custom_props)dn.set_property(k,dn.the_file.custom_props[k])};dn.set_property=function(prop_name,new_val){var oldVal=dn.the_file.custom_props[prop_name];dn.the_file.custom_props[prop_name]=new_val;if(oldVal!==new_val)dn.property_updated(prop_name,new_val);if(!(gapi&&gapi.drive&&dn.the_file.file_id))return;var dummyCallback=function(){};if(dn.default_custom_props[prop_name]==new_val){if(dn.the_file.custom_prop_exists[prop_name]){dn.the_file.custom_prop_exists[prop_name]=false;gapi.client.drive.properties.delete({fileId:dn.the_file.file_id,propertyKey:prop_name,visibility:"PUBLIC"}).execute(dummyCallback)}}else{if(dn.the_file.custom_prop_exists[prop_name]&&oldVal!==new_val){gapi.client.drive.properties.patch({fileId:dn.the_file.file_id,propertyKey:prop_name,visibility:"PUBLIC",resource:{value:new_val}}).execute(dummyCallback)}else{dn.the_file.custom_prop_exists[prop_name]=true;gapi.client.drive.properties.insert({fileId:dn.the_file.file_id,resource:{key:prop_name,value:new_val,visibility:"PUBLIC"}}).execute(dummyCallback)}}};dn.document_drag_over=function(evt){evt=evt.originalEvent;evt.stopPropagation();evt.preventDefault();if(!(dn.the_file.is_brand_new&&dn.the_file.is_pristine)){evt.dataTransfer.dropEffect="none";if(dn.can_show_drag_drop_error){dn.show_error("File drag-drop is only permitted when the Drive Notpad page is displaying a new and unmodified file.");dn.can_show_drag_drop_error=false;setTimeout(function(){dn.can_show_drag_drop_error=true},dn.error_delay_ms)}return}evt.dataTransfer.dropEffect="copy"};dn.document_drop_file=function(evt){if(!(dn.the_file.is_brand_new&&dn.the_file.is_pristine))return;evt=evt.originalEvent;evt.stopPropagation();evt.preventDefault();var files=evt.dataTransfer.files;if(files.length>1){dn.show_error("You cannot drag-drop multiple files onto the Drive Notepad page, only individual files.")}var file=files[0];dn.the_file.title=file.name;dn.create_file();dn.the_file.isReading_file_object=true;dn.show_status();var r=new FileReader;r.onload=dn.dropped_file_read;r.readAsText(file)};dn.dropped_file_read=function(e){dn.the_file.isReading_file_object=false;dn.editor.getSession().setValue(e.target.result)};dn.focus_editor=function(){dn.editor.focus()};dn.document_ready=function(e){dn.el.the_widget=document.getElementById("the_widget");dn.el.widget_text=document.getElementById("widget_text");dn.el.widget_error_text=document.getElementById("widget_error_text");dn.el.widget_error=document.getElementById("widget_error");dn.el.widget_content=document.getElementById("widget_content");dn.el.the_widget.addEventListener("mousedown",dn.widget_mouse_down);translate(dn.el.the_widget,0,0);dn.el.the_widget.style.display="";dn.el.widget_error.style.display="none";dn.el.widget_content.addEventListener("mousedown",function(e){e.preventDefault();e.stopPropagation()});var els=dn.el.widget_content.getElementsByTagName("input");for(var ii=0;ii<els.length;ii++)els[ii].addEventListener("mousedown",stop_propagation);var editor_el=document.getElementById("the_editor");editor_el.innerHTML="";editor_el.addEventListener("contextmenu",function(e){dn.show_error("See the list of keyboard shortcuts for copy/paste, select-all, and undo/redo.")});dn.editor=ace.edit("the_editor");dn.editor.setHighlightSelectedWord(true);dn.el.ace_content=document.getElementsByClassName("ace_content")[0];dn.editor.getSession().addEventListener("change",dn.on_change);dn.focus_editor();dn.editor.on("paste",dn.on_paste);dn.editor.on("copy",dn.on_copy);dn.editor.setAnimatedScroll(true);dn.editor.$blockScrolling=Infinity;dn.el.widget_menu=document.getElementById("widget_menu");dn.el.menu_open=document.getElementById("menu_open");dn.el.menu_find=document.getElementById("menu_find");dn.el.menu_help=document.getElementById("menu_help");dn.el.menu_file=document.getElementById("menu_file");dn.el.menu_general_settings=document.getElementById("menu_general_settings");dn.el.widget_menu.addEventListener("mousedown",stop_propagation);dn.menu_icon_from_pane_id={};var els=dn.el.widget_menu.getElementsByClassName("widget_menu_wrapper");for(var ii=0;ii<els.length;ii++){els[ii].addEventListener("mousedown",prevent_default);els[ii].title=dn.menu_id_to_caption[els[ii].id];els[ii].innerHTML="<div class='widget_menu_icon' id='icon_"+els[ii].id+"'></div>";var el_icon=els[ii].getElementsByClassName("widget_menu_icon")[0];dn.menu_icon_from_pane_id["pane_"+els[ii].id.substr(5)]=el_icon}dn.el.pane_file=document.getElementById("pane_file");dn.el.details_title_input=document.getElementById("details_file_title_input");dn.el.details_title_text=document.getElementById("details_file_title_text");dn.el.details_description_input=document.getElementById("details_file_description_input");dn.el.details_description_text=document.getElementById("details_file_description_text");dn.el.file_ace_mode_choose=document.getElementById("file_ace_mode_choose");dn.el.file_ace_mode_detect=document.getElementById("file_ace_mode_detect");dn.el.file_ace_mode_info=document.getElementById("file_ace_mode_info");dn.el.file_newline_detect=document.getElementById("file_newline_detect");dn.el.file_newline_windows=document.getElementById("file_newline_windows");dn.el.file_newline_unix=document.getElementById("file_newline_unix");dn.el.file_newline_info=document.getElementById("file_newline_info");dn.el.file_tab_detect=document.getElementById("file_tab_detect");dn.el.file_tab_hard=document.getElementById("file_tab_hard");dn.el.file_tab_soft=document.getElementById("file_tab_soft");dn.el.file_tab_soft_text=document.getElementById("file_tab_soft_text");dn.el.file_tab_info=document.getElementById("file_tab_info");dn.el.button_save=document.getElementById("button_save");dn.el.button_print=document.getElementById("button_print");dn.el.button_share=document.getElementById("button_share");dn.el.button_history=document.getElementById("button_history");dn.syntax_drop_down=dn.create_syntax_menu();dn.el.file_ace_mode_choose.appendChild(dn.syntax_drop_down.el);dn.create_file_details_tool();dn.el.menu_file.addEventListener("click",function(){dn.g_settings.set("pane","pane_file")});dn.el.pane_general_settings=document.getElementById("pane_general_settings");dn.el.theme_chooser=document.getElementById("theme_chooser");dn.el.widget_sub_general_box=document.getElementById("sub_general_box");dn.el.button_clear_clipboard=document.getElementById("button_clear_clipboard");dn.el.button_clear_find_replace=document.getElementById("button_clear_find_replace");dn.el.gutter_history_show=document.getElementById("gutter_history_show");dn.el.gutter_history_hide=document.getElementById("gutter_history_hide");dn.el.word_wrap_off=document.getElementById("word_wrap_off");dn.el.word_wrap_at=document.getElementById("word_wrap_at");dn.el.word_wrap_edge=document.getElementById("word_wrap_edge");dn.el.font_size_decrement=document.getElementById("font_size_decrement");dn.el.font_size_increment=document.getElementById("font_size_increment");dn.el.font_size_text=document.getElementById("font_size_text");dn.el.tab_hard=document.getElementById("tab_hard");dn.el.tab_soft=document.getElementById("tab_soft");dn.el.newline_menu_windows=document.getElementById("newline_menu_windows");dn.el.newline_menu_unix=document.getElementById("newline_menu_unix");dn.el.tab_soft_text=document.getElementById("tab_soft_text");dn.el.tab_soft_dec=document.getElementById("tab_soft_dec");dn.el.tab_soft_inc=document.getElementById("tab_soft_inc");dn.el.word_wrap_at_text=document.getElementById("word_wrap_at_text");dn.el.word_wrap_at_dec=document.getElementById("word_wrap_at_dec");dn.el.word_wrap_at_inc=document.getElementById("word_wrap_at_inc");dn.theme_drop_down=dn.create_theme_menu();dn.el.theme_chooser.appendChild(dn.theme_drop_down.el);dn.el.newline_menu_windows.addEventListener("click",function(){dn.g_settings.set("newLineDefault","windows")});dn.el.newline_menu_unix.addEventListener("click",function(){dn.g_settings.set("newLineDefault","unix")});dn.el.tab_hard.addEventListener("click",function(){dn.g_settings.set("tabIsHard",1)});dn.el.tab_soft.addEventListener("click",function(){dn.g_settings.set("tabIsHard",0)});dn.el.tab_soft_dec.addEventListener("click",function(){var at=dn.g_settings.get("softTabN")-1;at=at<dn.min_soft_tab_n?dn.min_soft_tab_n:at;dn.g_settings.set("softTabN",at)});dn.el.tab_soft_dec.addEventListener("click",function(){var at=dn.g_settings.get("softTabN")+1;at=at>dn.max_soft_tab_n?dn.max_soft_tab_n:at;dn.g_settings.set("softTabN",at)});dn.el.font_size_decrement.addEventListener("click",dn.font_size_decrement_click);dn.el.font_size_increment.addEventListener("click",dn.font_size_increment_click);dn.el.word_wrap_off.addEventListener("click",function(){dn.g_settings.set("wordWrap",[0,0,0])});dn.el.word_wrap_at.addEventListener("click",function(){var at=dn.g_settings.get("wordWrapAt");dn.g_settings.set("wordWrap",[1,at,at])});dn.el.word_wrap_at_dec.addEventListener("click",function(){var at=dn.g_settings.get("wordWrapAt")-dn.wrap_at_increment;at=at<dn.min_wrap_at?dn.min_wrap_at:at;dn.g_settings.set("wordWrapAt",at)});dn.el.word_wrap_at_inc.addEventListener("click",function(){var at=dn.g_settings.get("wordWrapAt")+dn.wrap_at_increment;at=at>dn.max_wrap_at?dn.max_wrap_at:at;dn.g_settings.set("wordWrapAt",at)});dn.el.word_wrap_edge.addEventListener("click",function(){dn.g_settings.set("wordWrap",[1,null,null])});dn.el.gutter_history_show.addEventListener("click",function(){dn.g_settings.set("showGutterHistory",1)});dn.el.gutter_history_hide.addEventListener("click",function(){dn.g_settings.set("showGutterHistory",0)});dn.create_clipboard_tool();dn.el.menu_general_settings.addEventListener("click",function(){dn.g_settings.set("pane","pane_general_settings")});dn.el.pane_permissions=document.getElementById("pane_permissions");document.getElementById("button_auth").addEventListener("click",dn.launch_popup);dn.el.pane_help=document.getElementById("pane_help");dn.el.user_name=document.getElementById("user_name");dn.el.pane_help_shortcuts=document.getElementById("pane_help_shortcuts");dn.el.pane_help_tips=document.getElementById("pane_help_tips");dn.el.pane_help_main=document.getElementById("pane_help_main");dn.el.button_shortcuts=document.getElementById("button_view_shortcuts");dn.el.button_tips=document.getElementById("button_view_tips");dn.el.button_shortcuts.addEventListener("click",function(){if(dn.g_settings.get("help_inner")==="shortcuts")dn.g_settings.set("help_inner","main");else dn.g_settings.set("help_inner","shortcuts")});dn.el.button_tips.addEventListener("click",function(){if(dn.g_settings.get("help_inner")==="tips")dn.g_settings.set("help_inner","main");else dn.g_settings.set("help_inner","tips")});dn.el.menu_help.addEventListener("click",function(){dn.g_settings.set("pane","pane_help")});dn.create_pane_shortcuts();dn.el.pane_find=document.getElementById("pane_find");dn.el.find_button_case_sensitive=document.getElementById("button_find_case_sensitive");dn.el.find_button_whole_words=document.getElementById("button_find_whole_words");dn.el.find_button_regex=document.getElementById("button_find_regex");dn.el.find_input=document.getElementById("find_input");dn.el.find_goto_input=document.getElementById("goto_input");dn.el.find_replace_input=document.getElementById("find_replace_input");dn.el.find_info=document.getElementById("find_info");dn.el.find_results=document.getElementById("find_results");dn.el.find_info_overflow=document.getElementById("find_info_overflow");dn.el.button_goto=document.getElementById("button_goto");dn.el.button_replace=document.getElementById("button_replace");dn.el.find_goto_wrapper=document.getElementById("find_goto_wrapper");dn.el.find_find_wrapper=document.getElementById("find_find_wrapper");dn.el.find_replace_wrapper=document.getElementById("find_replace_wrapper");dn.el.button_find_replace_all=document.getElementById("button_find_replace_all");dn.el.find_button_case_sensitive.addEventListener("click",function(){dn.g_settings.set("find_case_sensitive",!dn.g_settings.get("find_case_sensitive"))});dn.el.find_button_whole_words.addEventListener("click",function(){dn.g_settings.set("find_whole_words",!dn.g_settings.get("find_whole_words"))});dn.el.find_button_regex.addEventListener("click",function(){dn.g_settings.set("find_regex",!dn.g_settings.get("find_regex"))});dn.el.menu_find.addEventListener("click",function(){dn.g_settings.set("pane","pane_find");if(dn.g_settings.get("find_goto"))dn.el.find_goto_input.focus();else dn.el.find_input.focus()});dn.el.find_goto_input.addEventListener("keydown",dn.find_goto_input_keydown);dn.el.find_goto_input.addEventListener("keyup",dn.find_goto_input_keyup);dn.el.find_goto_input.addEventListener("blur",dn.find_goto_input_blur);dn.el.find_goto_input.addEventListener("focus",dn.find_goto_input_focus);dn.el.find_input.addEventListener("keyup",dn.find_input_keyup);dn.el.find_input.addEventListener("keydown",dn.find_input_keydown);dn.el.find_input.addEventListener("blur",dn.find_inputs_blur);dn.el.find_input.addEventListener("focus",dn.find_inputs_focus);dn.el.find_replace_input.addEventListener("blur",dn.find_inputs_blur);dn.el.find_replace_input.addEventListener("focus",dn.find_inputs_focus);dn.el.find_replace_input.addEventListener("keydown",dn.find_replace_input_keydown);dn.el.button_find_replace_all.addEventListener("click",dn.find_replace_click);dn.el.button_replace.addEventListener("click",function(){dn.g_settings.set("find_replace",!dn.g_settings.get("find_replace"));dn.g_settings.set("find_goto",false);dn.el.find_input.focus()});dn.el.button_goto.addEventListener("click",function(){dn.g_settings.set("find_goto",!dn.g_settings.get("find_goto"));if(dn.g_settings.get("find_goto"))dn.el.find_goto_input.focus();else dn.el.find_input.focus()});dn.el.pane_open=document.getElementById("pane_open");dn.el.opener_button_a=document.getElementById("opener_button_a");dn.el.menu_open.addEventListener("click",function(){dn.g_settings.set("pane","pane_open")});dn.el.opener_button_a.addEventListener("click",dn.open_button_click);dn.make_keyboard_shortcuts();dn.load_default_settings();dn.load_default_properties();document.addEventListener("contextmenu",prevent_default);document.addEventListener("dragover",dn.document_drag_over);document.addEventListener("drop",dn.document_drop_file);window.addEventListener("resize",dn.widget_apply_anchor);window.onbeforeunload=dn.query_unload;var params=window_location_to_params_object();if(params["state"]){var state={};try{state=JSON.parse(params["state"])}catch(e){dn.show_error("Bad URL params:\n"+params["state"])}if(state.action&&state.action=="open"&&state.ids&&state.ids.length>0){dn.the_file.file_id=state.ids[0]}else if(state.action&&state.action=="create"){dn.the_file.title="untitled."+(state.ext?state.ext:dn.g_settings.get("ext"));if(state.folderId)dn.the_file.folder_id=state.folderId;dn.create_file()}}else{dn.the_file.title="untitled."+dn.g_settings.get("ext");dn.create_file()}dn.pr_auth.then(dn.authentication_done);dn.show_status()};if(document.readyState!="loading")dn.document_ready();else document.addEventListener("DOMContentLoaded",dn.document_ready);
//# sourceMappingURL=all.build.map.js